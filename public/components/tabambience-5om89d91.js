import{r,j as s,S as V,X as P,V as X,f as H,g as J,R as W,h as Y,T as Z,i as ee,k as te,L as se}from"../vendor-BXLcLI7n.js";import{w as g,x as w}from"../index-NZtNjHC9.js";function ie(){const[C,A]=g("zen_sound_states",[]),l=r.useMemo(()=>w.map(e=>{const t=C.find(n=>n.id===e.id);return{id:e.id,volume:(t==null?void 0:t.volume)??.5,isPlaying:(t==null?void 0:t.isPlaying)??!1}}),[C]),m=e=>{const t=e.filter(n=>n.isPlaying||n.volume!==.5);A(t)},[D,v]=r.useState(new Set),[d,I]=g("zen_global_volume",1),[u,E]=r.useState(!1),j=r.useRef(u),k=r.useRef(d),y=r.useRef(l);r.useEffect(()=>{j.current=u},[u]),r.useEffect(()=>{k.current=d},[d]),r.useEffect(()=>{y.current=l},[l]);const[h,z]=r.useState(""),[M,$]=g("zen_collapsed_categories",[]),[R,L]=g("zen_sound_presets",[]),[b,f]=r.useState(""),[F,x]=r.useState(!1),c=r.useRef({});r.useEffect(()=>{Object.entries(c.current).forEach(([e,t])=>{if(u)t.pause();else{const n=y.current.find(a=>a.id===e);n!=null&&n.isPlaying&&t.play().catch(()=>{})}})},[u]),r.useEffect(()=>{Object.entries(c.current).forEach(([e,t])=>{const n=y.current.find(a=>a.id===e);n&&(t.volume=n.volume*d)})},[d]),r.useEffect(()=>{if(j.current)return;let e=!1;return w.forEach(async t=>{const n=l.find(a=>a.id===t.id);if(n)if(n.isPlaying){if(!c.current[t.id]){v(i=>new Set([...i,t.id]));try{let i=t.url;if(typeof i=="function"&&(i=await i(),i=(i==null?void 0:i.default)||i,typeof i!="string")){v(N=>{const p=new Set(N);return p.delete(t.id),p});return}if(e)return;const o=new Audio(i);if(o.autoplay=!1,o.loop=!0,o.crossOrigin="anonymous",await new Promise((N,p)=>{o.addEventListener("canplaythrough",()=>N(),{once:!0}),o.addEventListener("error",()=>p(),{once:!0}),o.load()}),e)return;c.current[t.id]=o}finally{v(i=>{const o=new Set(i);return o.delete(t.id),o})}}if(e||j.current)return;const a=c.current[t.id];if(!a)return;a.volume=n.volume*k.current,a.paused&&a.play().catch(i=>console.log("Audio play prevented:",i))}else c.current[t.id]&&c.current[t.id].pause()}),()=>{e=!0}},[l]),r.useEffect(()=>()=>{Object.values(c.current).forEach(e=>{e.pause()})},[]);const O=e=>{const t=l.map(n=>n.id===e?{...n,isPlaying:!n.isPlaying}:n);m(t)},G=(e,t)=>{const n=l.map(a=>a.id===e?{...a,volume:t}:a);m(n)},Q=e=>{$(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])},S=r.useMemo(()=>{const e={};return w.forEach(t=>{(Array.isArray(t.category)?t.category:[t.category]).filter(Boolean).forEach(a=>{e[a]||(e[a]=[]),e[a].push(t)})}),e},[]),_=r.useMemo(()=>{if(!h.trim())return S;const e=h.toLowerCase(),t={};return Object.entries(S).forEach(([n,a])=>{const i=a.filter(o=>o.name.toLowerCase().includes(e));i.length>0&&(t[n]=i)}),t},[S,h]),T=()=>{if(!b.trim())return;const e=l.filter(n=>n.isPlaying);if(e.length===0){x(!1),f("");return}const t={id:Date.now().toString(),name:b.trim(),sounds:e};L(n=>[...n,t]),f(""),x(!1)},U=e=>{const t=l.map(n=>{const a=e.sounds.find(i=>i.id===n.id);return a?{...n,volume:a.volume,isPlaying:!0}:{...n,isPlaying:!1}});m(t)},q=e=>{L(t=>t.filter(n=>n.id!==e))},B=l.filter(e=>e.isPlaying).length,K=e=>{const t=l.find(a=>a.id===e.id);if(!t)return null;const n=D.has(e.id);return s.jsxs("div",{onClick:()=>!n&&O(e.id),className:`cursor-pointer flex flex-col items-center p-2 rounded-2xl border transition-all duration-200 ${t.isPlaying?"bg-white/20 border-white/40 shadow-lg scale-[1.02]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10"} ${n?"opacity-70 cursor-wait":""}`,children:[s.jsxs("div",{className:"text-3xl mb-2 filter drop-shadow-md relative",children:[e.emoji,n&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 rounded-full",children:s.jsx(se,{size:20,className:"animate-spin text-white"})})]}),s.jsx("div",{className:"text-sm font-medium mb-2",children:e.name}),t.isPlaying&&s.jsx("div",{className:"w-full h-6 flex items-center",onClick:a=>a.stopPropagation(),children:s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t.volume,onChange:a=>G(e.id,parseFloat(a.target.value)),className:`w-full h-1 rounded-lg appearance-none cursor-pointer transition-colors ${t.isPlaying?"bg-white/40 accent-white":"bg-white/10 accent-white/50"}`})})]},e.id)};return s.jsxs("div",{className:"space-y-4 pb-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(V,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40"}),s.jsx("input",{type:"text",value:h,onChange:e=>z(e.target.value),placeholder:"Search sounds...",className:"w-full bg-white/5 border border-white/10 rounded-lg pl-9 pr-3 py-2 text-sm focus:outline-none focus:border-white/30 transition-colors"}),h&&s.jsx("button",{onClick:()=>z(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/40 hover:text-white",children:s.jsx(P,{size:14})})]}),B>0&&s.jsxs("div",{className:"bg-white/5 rounded-xl p-3 space-y-3",children:[s.jsx("div",{className:"flex flex-wrap gap-1",children:w.filter(e=>l.find(t=>t.id===e.id&&t.isPlaying)).map(e=>s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-white/10 rounded-full text-xs group cursor-pointer hover:bg-white/20 transition-colors",onClick:()=>O(e.id),title:`Turn off ${e.name}`,children:[s.jsx("span",{children:e.emoji}),s.jsx("span",{className:"text-white/70 group-hover:text-white",children:e.name}),s.jsx(P,{size:12,className:"opacity-0 group-hover:opacity-100 text-white/60 hover:text-white transition-opacity -mr-1"})]},e.id))}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(X,{size:16,className:"text-white/60 shrink-0"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d,onChange:e=>{const t=parseFloat(e.target.value);I(t),Object.entries(c.current).forEach(([n,a])=>{const i=l.find(o=>o.id===n);i&&a&&(a.volume=i.volume*t)})},className:"flex-1 h-1 rounded-lg appearance-none cursor-pointer bg-white/20 accent-white"}),s.jsxs("span",{className:"text-xs text-white/60 w-8 text-right",children:[Math.round(d*100),"%"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{E(e=>{const t=!e;return Object.values(c.current).forEach(n=>{t?n.pause():l.find(i=>c.current[i.id]===n&&i.isPlaying)&&n.play().catch(()=>{})}),t})},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:u?"Resume all sounds":"Pause all sounds",children:[u?s.jsx(H,{size:16}):s.jsx(J,{size:16}),s.jsx("span",{className:"text-sm",children:u?"Play":"Pause"})]}),s.jsx("button",{onClick:()=>{const e=l.map(t=>({...t,isPlaying:!1}));m(e),E(!1)},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:"Turn off all sounds",children:s.jsx(W,{size:16})}),s.jsx("button",{onClick:()=>x(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:"Save current mix",children:s.jsx(Y,{size:16})})]})]}),F&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"Preset name...",autoFocus:!0,onKeyDown:e=>{e.key==="Enter"&&T(),e.key==="Escape"&&(x(!1),f(""))},className:"flex-1 bg-white/5 border border-white/20 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-white/40"}),s.jsx("button",{onClick:T,className:"px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm",children:"Save"}),s.jsx("button",{onClick:()=>{x(!1),f("")},className:"px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg",children:s.jsx(P,{size:16})})]}),R.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"text-xs font-bold text-white/50 uppercase tracking-wider",children:"My Presets"}),s.jsx("div",{className:"space-y-1",children:R.map(e=>s.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors group",children:[s.jsxs("button",{onClick:()=>U(e),className:"flex-1 flex items-center gap-2 text-left",children:[s.jsx("span",{className:"text-sm font-medium",children:e.name}),s.jsxs("span",{className:"text-xs text-white/40",children:["(",e.sounds.length," sounds)"]})]}),s.jsx("button",{onClick:t=>{t.stopPropagation(),q(e.id)},className:"p-1 opacity-0 group-hover:opacity-100 text-white/40 hover:text-red-400 transition-all",children:s.jsx(Z,{size:14})})]},e.id))})]}),s.jsx("div",{children:Object.keys(_).length===0?s.jsxs("div",{className:"text-center py-8 text-white/40",children:[s.jsx(V,{size:32,className:"mx-auto mb-2 opacity-50"}),s.jsxs("p",{className:"text-sm",children:['No sounds found for "',h,'"']})]}):Object.entries(_).map(([e,t])=>{const a=!(M.includes(e)&&!h);return s.jsxs("div",{children:[s.jsx("button",{onClick:()=>Q(e),className:"w-full flex items-center justify-between py-2 px-1 text-left hover:bg-white/5 rounded-lg transition-colors",children:s.jsxs("div",{className:"flex items-center gap-2",children:[a?s.jsx(ee,{size:16,className:"text-white/50"}):s.jsx(te,{size:16,className:"text-white/50"}),s.jsx("span",{className:"text-sm font-semibold",children:e}),s.jsxs("span",{className:"text-xs text-white/40",children:["(",t.length,")"]})]})}),s.jsx("div",{className:`grid grid-cols-2 p-1 gap-3 overflow-hidden transition-all duration-300 ${a?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:a&&t.map(i=>K(i))})]},e)})})]})}export{ie as default};
