import{r as l,j as t,S as _,X as b,V as U,f as q,g as B,R as K,h as X,T as H,i as J,k as W,L as Y}from"../vendor-C0nNVFzt.js";import{w as f,x as w}from"../index-kAxOYwDN.js";function te(){const[N,O]=f("zen_sound_states",[]),r=l.useMemo(()=>w.map(e=>{const s=N.find(a=>a.id===e.id);return{id:e.id,volume:(s==null?void 0:s.volume)??.5,isPlaying:(s==null?void 0:s.isPlaying)??!1}}),[N]),m=e=>{const s=e.filter(a=>a.isPlaying||a.volume!==.5);O(s)},[R,v]=l.useState(new Set),[p,T]=f("zen_global_volume",1),[u,S]=l.useState(!1),[c,P]=l.useState(""),[A,V]=f("zen_collapsed_categories",[]),[C,k]=f("zen_sound_presets",[]),[j,h]=l.useState(""),[D,x]=l.useState(!1),o=l.useRef({});l.useEffect(()=>(w.forEach(async e=>{const s=r.find(a=>a.id===e.id);if(s)if(s.isPlaying){if(!o.current[e.id]){v(i=>new Set([...i,e.id]));try{let i=e.url;if(typeof i=="function"&&(i=await i(),i=(i==null?void 0:i.default)||i,typeof i!="string")){v(d=>{const g=new Set(d);return g.delete(e.id),g});return}const n=new Audio(i);n.loop=!0,n.crossOrigin="anonymous",await new Promise((d,g)=>{n.addEventListener("canplaythrough",()=>d(),{once:!0}),n.addEventListener("error",()=>g(),{once:!0}),n.load()}),o.current[e.id]=n}finally{v(i=>{const n=new Set(i);return n.delete(e.id),n})}}const a=o.current[e.id];if(!a)return;a.volume=s.volume*p,a.paused&&!u&&a.play().catch(i=>console.log("Audio play prevented:",i))}else o.current[e.id]&&o.current[e.id].pause()}),()=>{Object.values(o.current).forEach(e=>{e.pause()})}),[r,p,u]);const z=e=>{const s=r.map(a=>a.id===e?{...a,isPlaying:!a.isPlaying}:a);m(s)},I=(e,s)=>{const a=r.map(i=>i.id===e?{...i,volume:s}:i);m(a)},M=e=>{V(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},y=l.useMemo(()=>{const e={};return w.forEach(s=>{(Array.isArray(s.category)?s.category:[s.category]).filter(Boolean).forEach(i=>{e[i]||(e[i]=[]),e[i].push(s)})}),e},[]),E=l.useMemo(()=>{if(!c.trim())return y;const e=c.toLowerCase(),s={};return Object.entries(y).forEach(([a,i])=>{const n=i.filter(d=>d.name.toLowerCase().includes(e));n.length>0&&(s[a]=n)}),s},[y,c]),L=()=>{if(!j.trim())return;const e=r.filter(a=>a.isPlaying);if(e.length===0){x(!1),h("");return}const s={id:Date.now().toString(),name:j.trim(),sounds:e};k(a=>[...a,s]),h(""),x(!1)},$=e=>{const s=r.map(a=>{const i=e.sounds.find(n=>n.id===a.id);return i?{...a,volume:i.volume,isPlaying:!0}:{...a,isPlaying:!1}});m(s)},F=e=>{k(s=>s.filter(a=>a.id!==e))},G=r.filter(e=>e.isPlaying).length,Q=e=>{const s=r.find(i=>i.id===e.id);if(!s)return null;const a=R.has(e.id);return t.jsxs("div",{onClick:()=>!a&&z(e.id),className:`cursor-pointer flex flex-col items-center p-2 rounded-2xl border transition-all duration-200 ${s.isPlaying?"bg-white/20 border-white/40 shadow-lg scale-[1.02]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10"} ${a?"opacity-70 cursor-wait":""}`,children:[t.jsxs("div",{className:"text-3xl mb-2 filter drop-shadow-md relative",children:[e.emoji,a&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 rounded-full",children:t.jsx(Y,{size:20,className:"animate-spin text-white"})})]}),t.jsx("div",{className:"text-sm font-medium mb-2",children:e.name}),s.isPlaying&&t.jsx("div",{className:"w-full h-6 flex items-center",onClick:i=>i.stopPropagation(),children:t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.volume,onChange:i=>I(e.id,parseFloat(i.target.value)),className:`w-full h-1 rounded-lg appearance-none cursor-pointer transition-colors ${s.isPlaying?"bg-white/40 accent-white":"bg-white/10 accent-white/50"}`})})]},e.id)};return t.jsxs("div",{className:"space-y-4 pb-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(_,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40"}),t.jsx("input",{type:"text",value:c,onChange:e=>P(e.target.value),placeholder:"Search sounds...",className:"w-full bg-white/5 border border-white/10 rounded-lg pl-9 pr-3 py-2 text-sm focus:outline-none focus:border-white/30 transition-colors"}),c&&t.jsx("button",{onClick:()=>P(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/40 hover:text-white",children:t.jsx(b,{size:14})})]}),G>0&&t.jsxs("div",{className:"bg-white/5 rounded-xl p-3 space-y-3",children:[t.jsx("div",{className:"flex flex-wrap gap-1",children:w.filter(e=>r.find(s=>s.id===e.id&&s.isPlaying)).map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-white/10 rounded-full text-xs group cursor-pointer hover:bg-white/20 transition-colors",onClick:()=>z(e.id),title:`Turn off ${e.name}`,children:[t.jsx("span",{children:e.emoji}),t.jsx("span",{className:"text-white/70 group-hover:text-white",children:e.name}),t.jsx(b,{size:12,className:"opacity-0 group-hover:opacity-100 text-white/60 hover:text-white transition-opacity -mr-1"})]},e.id))}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(U,{size:16,className:"text-white/60 shrink-0"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p,onChange:e=>{const s=parseFloat(e.target.value);T(s),Object.entries(o.current).forEach(([a,i])=>{const n=r.find(d=>d.id===a);n&&i&&(i.volume=n.volume*s)})},className:"flex-1 h-1 rounded-lg appearance-none cursor-pointer bg-white/20 accent-white"}),t.jsxs("span",{className:"text-xs text-white/60 w-8 text-right",children:[Math.round(p*100),"%"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{S(e=>{const s=!e;return Object.values(o.current).forEach(a=>{s?a.pause():r.find(n=>o.current[n.id]===a&&n.isPlaying)&&a.play().catch(()=>{})}),s})},className:"flex-1 flex items-center justify-center gap-2 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:u?"Resume all sounds":"Pause all sounds",children:[u?t.jsx(q,{size:16}):t.jsx(B,{size:16}),t.jsx("span",{className:"text-sm",children:u?"Play":"Pause"})]}),t.jsx("button",{onClick:()=>{const e=r.map(s=>({...s,isPlaying:!1}));m(e),S(!1)},className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:"Turn off all sounds",children:t.jsx(K,{size:16})}),t.jsx("button",{onClick:()=>x(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all",title:"Save current mix",children:t.jsx(X,{size:16})})]})]}),D&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:j,onChange:e=>h(e.target.value),placeholder:"Preset name...",autoFocus:!0,onKeyDown:e=>{e.key==="Enter"&&L(),e.key==="Escape"&&(x(!1),h(""))},className:"flex-1 bg-white/5 border border-white/20 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-white/40"}),t.jsx("button",{onClick:L,className:"px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm",children:"Save"}),t.jsx("button",{onClick:()=>{x(!1),h("")},className:"px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg",children:t.jsx(b,{size:16})})]}),C.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-xs font-bold text-white/50 uppercase tracking-wider",children:"My Presets"}),t.jsx("div",{className:"space-y-1",children:C.map(e=>t.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors group",children:[t.jsxs("button",{onClick:()=>$(e),className:"flex-1 flex items-center gap-2 text-left",children:[t.jsx("span",{className:"text-sm font-medium",children:e.name}),t.jsxs("span",{className:"text-xs text-white/40",children:["(",e.sounds.length," sounds)"]})]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),F(e.id)},className:"p-1 opacity-0 group-hover:opacity-100 text-white/40 hover:text-red-400 transition-all",children:t.jsx(H,{size:14})})]},e.id))})]}),Object.keys(E).length===0?t.jsxs("div",{className:"text-center py-8 text-white/40",children:[t.jsx(_,{size:32,className:"mx-auto mb-2 opacity-50"}),t.jsxs("p",{className:"text-sm",children:['No sounds found for "',c,'"']})]}):Object.entries(E).map(([e,s])=>{const i=!(A.includes(e)&&!c);return t.jsxs("div",{className:"space-y-2",children:[t.jsx("button",{onClick:()=>M(e),className:"w-full flex items-center justify-between py-2 px-1 text-left hover:bg-white/5 rounded-lg transition-colors",children:t.jsxs("div",{className:"flex items-center gap-2",children:[i?t.jsx(J,{size:16,className:"text-white/50"}):t.jsx(W,{size:16,className:"text-white/50"}),t.jsx("span",{className:"text-sm font-semibold",children:e}),t.jsxs("span",{className:"text-xs text-white/40",children:["(",s.length,")"]})]})}),t.jsx("div",{className:`grid grid-cols-2 p-1 gap-3 overflow-hidden transition-all duration-300 ${i?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:s.map(n=>Q(n))})]},e)})]})}export{te as default};
