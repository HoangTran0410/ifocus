import{r,j as t,P as j,X as N,H as U,M as S}from"../vendor-BT9BOIqP.js";import{u as x,D as f}from"../index-C5euZUif.js";function Y(){const[b,k]=x("zen_sound_states",[]),n=r.useMemo(()=>f.map(e=>{const i=b.find(s=>s.id===e.id);return{id:e.id,volume:(i==null?void 0:i.volume)??.5,isPlaying:(i==null?void 0:i.isPlaying)??!1}}),[b]),w=e=>{const i=e.filter(s=>s.isPlaying||s.volume!==.5);k(i)},[y,m]=x("zen_yt_url",""),[d,g]=x("zen_yt_history",[]),[l,v]=r.useState("sounds"),[u,h]=r.useState(y),o=r.useRef({});r.useEffect(()=>(f.forEach(async e=>{const i=n.find(s=>s.id===e.id);if(i)if(i.isPlaying){if(!o.current[e.id]){let a=e.url;if(typeof a=="function"&&(a=await a(),a=(a==null?void 0:a.default)||a,typeof a!="string"))return;o.current[e.id]=new Audio(a),o.current[e.id].loop=!0,o.current[e.id].crossOrigin="anonymous"}const s=o.current[e.id];if(s.volume=i.volume,s.paused){const a=s.play();a!==void 0&&a.catch(H=>console.log("Audio play prevented:",H))}}else o.current[e.id]&&o.current[e.id].pause()}),()=>{Object.values(o.current).forEach(e=>{e.pause()})}),[n]);const P=e=>{const i=[e,...d.filter(s=>s!==e)].slice(0,5);g(i)},C=e=>{g(d.filter(i=>i!==e))},z=e=>{const i=n.map(s=>s.id===e?{...s,isPlaying:!s.isPlaying}:s);w(i)},M=(e,i)=>{const s=n.map(a=>a.id===e?{...a,volume:i}:a);w(s)},T=e=>{e.preventDefault(),u&&(m(u),P(u))},A=e=>{h(e),m(e)},[p,E]=r.useState(new Set(["sounds"]));r.useEffect(()=>{p.has(l)||E(e=>new Set([...e,l]))},[l,p]);const c=(e=>{if(!e)return null;const i=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);if(i&&i[2].length===11)return{type:"youtube",src:`https://www.youtube.com/embed/${i[2]}?enablejsapi=1&origin=${window.location.origin}`};if(e.includes("open.spotify.com")){let s=e;return e.includes("/embed")||(s=e.replace("open.spotify.com/","open.spotify.com/embed/")),{type:"spotify",src:s}}if(e.includes("music.apple.com")){let s=e;return e.includes("embed.music.apple.com")||(s=e.replace("music.apple.com","embed.music.apple.com")),{type:"apple",src:s}}return null})(y);return t.jsxs("div",{className:"flex flex-col h-full text-white",children:[t.jsxs("div",{className:"flex border-b border-white/10 mb-4",children:[t.jsx("button",{className:`flex-1 py-3 text-sm font-medium ${l==="sounds"?"border-b-2 border-white text-white":"text-white/50 hover:text-white"}`,onClick:()=>v("sounds"),children:"Ambience"}),t.jsx("button",{className:`flex-1 py-3 text-sm font-medium ${l==="media"?"border-b-2 border-white text-white":"text-white/50 hover:text-white"}`,onClick:()=>v("media"),children:"Media"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-1 pt-3",children:[t.jsx("div",{className:l==="sounds"?"block":"hidden",children:p.has("sounds")&&t.jsx("div",{className:"grid grid-cols-2 gap-3 pb-4",children:f.map(e=>{const i=n.find(s=>s.id===e.id);return i?t.jsxs("div",{onClick:()=>z(e.id),className:`cursor-pointer flex flex-col items-center p-2 rounded-2xl border transition-all duration-200 ${i.isPlaying?"bg-white/20 border-white/40 shadow-lg scale-[1.02]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10"}`,children:[t.jsx("div",{className:"text-3xl mb-2 filter drop-shadow-md",children:e.emoji}),t.jsx("div",{className:"text-sm font-medium mb-2",children:e.name}),i.isPlaying&&t.jsx("div",{className:"w-full h-6 flex items-center",onClick:s=>s.stopPropagation(),children:t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:i.volume,onChange:s=>M(e.id,parseFloat(s.target.value)),className:`w-full h-1 rounded-lg appearance-none cursor-pointer transition-colors ${i.isPlaying?"bg-white/40 accent-white":"bg-white/10 accent-white/50"}`})})]},e.id):null})})}),t.jsx("div",{className:l==="media"?"block":"hidden",children:p.has("media")&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("form",{onSubmit:T,className:"space-y-2",children:[t.jsx("label",{className:"text-xs text-white/70 uppercase tracking-wider",children:"Media URL"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"YouTube, Spotify, Apple Music...",className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-white/50 transition-colors"}),t.jsx("button",{type:"submit",className:"bg-white/10 text-white p-2 rounded-lg hover:bg-white/20",children:t.jsx(j,{size:18})})]})]}),c&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-sm text-white/70 flex items-center gap-2",children:[c.type==="spotify"?"Spotify":c.type==="apple"?"Apple Music":"YouTube"," ","Player"]}),t.jsx("button",{onClick:()=>{m(""),h("")},className:"p-1 text-white/50 hover:text-white hover:bg-white/10 rounded transition-all",title:"Close player",children:t.jsx(N,{size:16})})]}),t.jsx("div",{className:`relative bg-black rounded-xl overflow-hidden shadow-lg border border-white/10 ${c.type==="youtube"?"pt-[56.25%]":"h-40"}`,children:t.jsx("iframe",{className:"absolute top-0 left-0 w-full h-full",src:c.src,title:"Media player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,style:{border:0}})})]}),d.length>0&&t.jsxs("div",{className:"border-t border-white/10 pt-4",children:[t.jsxs("h4",{className:"text-xs font-bold text-white/50 uppercase mb-3 flex items-center gap-2",children:[t.jsx(U,{size:12})," Recent"]}),t.jsx("div",{className:"space-y-2",children:d.map((e,i)=>t.jsxs("div",{className:"w-full flex items-center gap-3 p-2 rounded-lg hover:bg-white/10 text-left group transition-colors",children:[t.jsxs("button",{onClick:()=>A(e),className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-8 h-6 bg-white/10 rounded flex items-center justify-center shrink-0",children:e.includes("spotify")?t.jsx(S,{size:12,className:"text-green-400"}):e.includes("apple")?t.jsx(S,{size:12,className:"text-pink-500"}):t.jsx(j,{size:10,fill:"white",className:"ml-0.5"})}),t.jsx("span",{className:"text-xs text-white/70 truncate flex-1 group-hover:text-white",children:e})]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),C(e)},className:"p-1 opacity-0 group-hover:opacity-100 text-white/50 hover:text-white hover:bg-white/10 rounded transition-all shrink-0",title:"Remove from history",children:t.jsx(N,{size:14})})]},i))})]}),t.jsx("div",{className:"text-xs text-white/30 leading-relaxed",children:"Supports YouTube videos, Spotify tracks/playlists, and Apple Music albums. Paste the link and we'll handle the embed."})]})})]})]})}export{Y as default};
