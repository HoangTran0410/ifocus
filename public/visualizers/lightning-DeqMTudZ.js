const g={bolts:[],lastBeat:0,electricField:[]};function M(n,u,o,h){const r=[{x:n,y:u}];let s=n,d=u;const c=12+Math.random()*8;for(;d<o;){d+=c;const e=(Math.random()-.5)*(40+h*50);s+=e,r.push({x:s,y:d})}return r}function L(n,u,o){const h=M(n,-10,u,o);return{segments:h,currentLength:1,maxLength:h.length,alpha:1,hue:180+Math.random()*60,width:2+o*3,speed:3+o*4+Math.random()*2}}function w({ctx:n,canvas:u,data:o,performanceMode:h=!1,bass:r=0}){const s=u.width,d=u.height,c=o.reduce((e,a)=>e+a,0)/o.length;if(r>.35&&Date.now()-g.lastBeat>120){const e=h?1:Math.floor(1+r*2);for(let t=0;t<e;t++){const l=s*.2+Math.random()*s*.6,i=d*(.5+Math.random()*.5);g.bolts.push(L(l,i,r))}const a=Math.floor(r*12);for(let t=0;t<a;t++)g.electricField.push({x:Math.random()*s,y:Math.random()*d*.7,age:0});g.lastBeat=Date.now()}if(Math.random()<.015+c*.02){const e=s*.1+Math.random()*s*.8,a=d*(.3+Math.random()*.4);g.bolts.push(L(e,a,c*.6))}if(g.electricField=g.electricField.filter(e=>{if(e.age+=.06,e.age>1)return!1;const a=1-e.age,t=1.5+(1-e.age)*2;return n.beginPath(),n.arc(e.x,e.y,t,0,Math.PI*2),n.fillStyle=`rgba(150, 200, 255, ${a*.7})`,n.fill(),!0}),g.bolts=g.bolts.filter(e=>{if(e.alpha<=0)return!1;e.currentLength<e.maxLength&&(e.currentLength=Math.min(e.currentLength+e.speed,e.maxLength));const a=Math.floor(e.currentLength);if(a<2)return!0;n.beginPath(),n.moveTo(e.segments[0].x,e.segments[0].y);for(let t=1;t<a;t++)n.lineTo(e.segments[t].x,e.segments[t].y);if(a<e.segments.length){const t=e.currentLength-a,l=e.segments[a-1],i=e.segments[a],f=l.x+(i.x-l.x)*t,m=l.y+(i.y-l.y)*t;n.lineTo(f,m)}if(h||(n.shadowColor=`hsla(${e.hue}, 100%, 70%, ${e.alpha})`,n.shadowBlur=20+r*15),n.strokeStyle=`hsla(${e.hue}, 100%, 75%, ${e.alpha})`,n.lineWidth=e.width*e.alpha,n.lineCap="round",n.lineJoin="round",n.stroke(),!h&&e.alpha>.5&&(n.strokeStyle=`rgba(255, 255, 255, ${e.alpha*.8})`,n.lineWidth=e.width*.35*e.alpha,n.stroke()),n.shadowBlur=0,e.currentLength<e.maxLength){const t=Math.min(a,e.segments.length-1),l=e.currentLength-Math.floor(e.currentLength);let i,f;if(t<e.segments.length-1){const p=e.segments[t],y=e.segments[t+1];i=p.x+(y.x-p.x)*l,f=p.y+(y.y-p.y)*l}else i=e.segments[t].x,f=e.segments[t].y;const m=n.createRadialGradient(i,f,0,i,f,15+r*10);m.addColorStop(0,`hsla(${e.hue}, 100%, 90%, ${e.alpha})`),m.addColorStop(.3,`hsla(${e.hue}, 100%, 70%, ${e.alpha*.6})`),m.addColorStop(1,"transparent"),n.beginPath(),n.arc(i,f,15+r*10,0,Math.PI*2),n.fillStyle=m,n.fill()}return e.currentLength>=e.maxLength&&(e.alpha-=h?.06:.035),e.alpha>0}),!h){const e=n.createLinearGradient(0,0,0,60);e.addColorStop(0,`rgba(100, 150, 255, ${.1+c*.15})`),e.addColorStop(1,"transparent"),n.fillStyle=e,n.fillRect(0,0,s,60)}if(r>.7){const e=(r-.7)*.25;n.fillStyle=`rgba(180, 220, 255, ${e})`,n.fillRect(0,0,s,d)}}export{w as default};
