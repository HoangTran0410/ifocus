const a={particles:[],rockets:[],shockwaves:[],lastBeatTime:0,beatFlash:0,lastCanvasHeight:0},C=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FF69B4","#00CED1","#FFD700","#FF4500"];function P(){return C[Math.floor(Math.random()*C.length)]}function A({ctx:l,canvas:i,data:R,performanceMode:o=!1,bass:d=0,mid:E=0}){const g=o?150:400,y=Date.now(),S=8,u=.15,B=4,b=.1,p=i.width/2,c=i.height/2;if(Math.abs(i.height-a.lastCanvasHeight)>50&&(a.rockets.length=0,a.particles.length=0,a.lastCanvasHeight=i.height),a.beatFlash>0&&(a.beatFlash-=.05),d>.4&&y-a.lastBeatTime>200){a.lastBeatTime=y,a.beatFlash=d;const e=i.width*(.1+Math.random()*.8),t=P();a.rockets.push({x:e,y:i.height,vy:-(S+d*5+Math.random()*3),targetY:i.height*(.15+Math.random()*.35),color:t,trail:[],isBeatRocket:!0}),a.shockwaves.push({x:e,y:i.height,radius:5,life:d*2.5,color:t})}if(a.beatFlash>0&&!o){const e=l.createRadialGradient(p,c,0,p,c,Math.max(i.width,i.height)*.6);e.addColorStop(0,`rgba(255, 200, 100, ${a.beatFlash*.5})`),e.addColorStop(.5,`rgba(255, 100, 50, ${a.beatFlash*.15})`),e.addColorStop(1,"transparent"),l.fillStyle=e,l.fillRect(0,0,i.width,i.height)}for(let e=a.rockets.length-1;e>=0;e--){const t=a.rockets[e];if(t.trail.push({x:t.x,y:t.y}),t.trail.length>12&&t.trail.shift(),t.y+=t.vy,t.vy+=u,!o&&t.trail.length>1){l.beginPath(),l.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(n=>l.lineTo(n.x,n.y));const r=l.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);r.addColorStop(0,"transparent"),r.addColorStop(1,t.color),l.strokeStyle=r,l.lineWidth=t.isBeatRocket?3:2,l.stroke()}const h=t.isBeatRocket?4:3;if(o||(l.shadowColor=t.color,l.shadowBlur=15),l.beginPath(),l.arc(t.x,t.y,h,0,Math.PI*2),l.fillStyle="#FFF",l.fill(),l.shadowBlur=0,t.y<=t.targetY||t.vy>=0){const r=o?25:60,n=t.isBeatRocket?r*1.5:r,w=t.isBeatRocket?1.3:1,F=Math.min(n,g);for(;a.particles.length+F>g&&a.particles.length>0;)a.particles.shift();for(let f=0;f<n&&!(a.particles.length>=g);f++){const s=Math.PI*2*f/n+Math.random()*.3,k=(B+Math.random()*3)*w;a.particles.push({x:t.x,y:t.y,vx:Math.cos(s)*k,vy:Math.sin(s)*k,life:1,maxLife:1,color:t.color,size:t.isBeatRocket?4:3,trail:[],isBeatParticle:t.isBeatRocket})}if(t.isBeatRocket&&!o){l.beginPath(),l.arc(t.x,t.y,40,0,Math.PI*2);const s=l.createRadialGradient(t.x,t.y,0,t.x,t.y,40);s.addColorStop(0,"rgba(255, 255, 255, 0.8)"),s.addColorStop(.5,`${t.color}80`),s.addColorStop(1,"transparent"),l.fillStyle=s,l.fill()}a.rockets.splice(e,1)}}for(let e=a.particles.length-1;e>=0;e--){const t=a.particles[e];if(o||(t.trail.push({x:t.x,y:t.y}),t.trail.length>6&&t.trail.shift()),t.x+=t.vx,t.y+=t.vy,t.vy+=b,t.vx*=.98,t.vy*=.98,t.life-=t.isBeatParticle?.015:.02,t.life<=0){a.particles.splice(e,1);continue}const h=t.life;!o&&t.trail.length>1&&(l.beginPath(),l.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(r=>l.lineTo(r.x,r.y)),l.globalAlpha=h*.5,l.strokeStyle=t.color,l.lineWidth=t.size*.4,l.stroke(),l.globalAlpha=1),l.beginPath(),l.arc(t.x,t.y,t.size*h,0,Math.PI*2),l.globalAlpha=h,l.fillStyle=t.color,!o&&t.isBeatParticle&&h>.4&&(l.shadowColor=t.color,l.shadowBlur=8),l.fill(),l.shadowBlur=0,l.globalAlpha=1}for(let e=a.shockwaves.length-1;e>=0;e--){const t=a.shockwaves[e];if(t.radius+=4,t.life-=.04,t.life<=0){a.shockwaves.splice(e,1);continue}l.beginPath(),l.arc(t.x,t.y,t.radius,Math.PI,0),l.strokeStyle=t.color,l.lineWidth=3+t.life*4,l.globalAlpha=t.life*.3,l.stroke(),l.globalAlpha=1}}export{A as default};
