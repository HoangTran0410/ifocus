import{F as C}from"./fluid-611bkV8C.js";import{g as T}from"./utils-DsFqD6CR.js";const t={simulation:null,lastCanvas:null,lastSize:{width:0,height:0},lastTime:0,performanceMode:!1,splatPoints:[],lastSplatTime:0,hue:0};function b(){const e=[];for(let n=0;n<12;n++){const o=n/12*Math.PI*2,l=.3+Math.random()*.15;e.push({x:.5+Math.cos(o)*l,y:.5+Math.sin(o)*l,angle:o+Math.PI,freqIndex:Math.floor(n/12*64)})}return e}function z({canvas:e,data:h,performanceMode:n=!1,bass:o=0,mid:l=0}){const i=performance.now();if(!t.simulation||t.lastCanvas!==e||t.lastSize.width!==e.width||t.lastSize.height!==e.height){t.simulation&&t.simulation.destroy();const c=document.createElement("canvas");c.width=e.width,c.height=e.height;try{t.simulation=new C(c,n),t.simulation.multipleSplats(Math.floor(Math.random()*5)+5)}catch(a){console.error("Failed to create fluid simulation:",a);return}t.lastCanvas=e,t.lastSize={width:e.width,height:e.height},t.performanceMode=n,t.splatPoints=b(),t.lastTime=i}t.performanceMode!==n&&(t.simulation.setPerformanceMode(n),t.performanceMode=n);const r=t.simulation;if(!r)return;const p=Math.min((i-t.lastTime)/1e3,.016666);if(t.lastTime=i,t.hue=(t.hue+p*.1)%1,i-t.lastSplatTime>(n?80:50)){t.lastSplatTime=i;const c=h.reduce((a,s)=>a+s,0)/h.length;if(o>.5){const a=Math.floor(o*5)+2;for(let s=0;s<a;s++){const f=Math.random(),M=Math.random(),d=Math.random()*Math.PI*2,w=3e3+o*1e4,x=Math.cos(d)*w,g=Math.sin(d)*w,y=(t.hue+Math.random()*.3)%1,P=I(y,1,1);P.r*=.3*o,P.g*=.3*o,P.b*=.3*o,r.splat(f,M,x,g,P)}}for(const a of t.splatPoints){const s=h[a.freqIndex]||0;if(s>.35+Math.random()*.2){const f=1500+s*4e3+l*3e3,M=Math.cos(a.angle)*f,d=Math.sin(a.angle)*f,w=a.freqIndex/64,x=(t.hue+w*.5)%1,g=I(x,.8+s*.2,1);g.r*=.15+s*.2,g.g*=.15+s*.2,g.b*=.15+s*.2,r.splat(a.x,a.y,M,d,g)}}if(Math.random()<.1+c*.3){const a=T();a.r*=5+c*10,a.g*=5+c*10,a.b*=5+c*10;const s=.2+Math.random()*.6,f=.2+Math.random()*.6,M=Math.random()*Math.PI*2,d=500+c*2e3;r.splat(s,f,Math.cos(M)*d,Math.sin(M)*d,a)}}r.step(p),r.render();const m=e.getContext("2d");m&&(m.clearRect(0,0,e.width,e.height),m.drawImage(r.canvas,0,0))}function I(e,h,n){let o=0,l=0,i=0;const r=Math.floor(e*6),p=e*6-r,u=n*(1-h),S=n*(1-p*h),m=n*(1-(1-p)*h);switch(r%6){case 0:o=n,l=m,i=u;break;case 1:o=S,l=n,i=u;break;case 2:o=u,l=n,i=m;break;case 3:o=u,l=S,i=n;break;case 4:o=m,l=u,i=n;break;case 5:o=n,l=u,i=S;break}return{r:o,g:l,b:i}}function F(){t.simulation&&(t.simulation.destroy(),t.simulation=null,t.lastCanvas=null,t.lastSize={width:0,height:0})}export{F as cleanup,z as default};
