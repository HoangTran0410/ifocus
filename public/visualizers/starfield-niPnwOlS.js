const l={stars:[],initialized:!1,shockwaves:[],lastBeatTime:0,rotation:0,coronaExplosion:null};function Y({ctx:t,canvas:i,data:S,performanceMode:C=!1,bass:r=0}){const a=i.width/2,n=i.height/2,P=S.reduce((o,e)=>o+e,0)/S.length,M=C?50:100,w=Date.now();if(!l.initialized||l.stars.length!==M){l.stars=[];for(let o=0;o<M;o++)l.stars.push({x:(Math.random()-.5)*i.width*2,y:(Math.random()-.5)*i.height*2,z:Math.random()*i.width,prevX:0,prevY:0});l.initialized=!0}r>.5&&w-l.lastBeatTime>400&&(l.lastBeatTime=w,l.shockwaves.push({radius:10,alpha:.5,hue:200+Math.random()*100}));const E=1+S.slice(0,Math.floor(S.length/4)).reduce((o,e)=>o+e,0)/(S.length/4)*4+r*8,T=r>.5;if(l.stars.forEach((o,e)=>{const u=o.z;o.prevX=o.x/u*i.width+a,o.prevY=o.y/u*i.height+n,o.z-=E,o.z<=0&&(o.x=(Math.random()-.5)*i.width*2,o.y=(Math.random()-.5)*i.height*2,o.z=i.width,o.prevX=o.x/o.z*i.width+a,o.prevY=o.y/o.z*i.height+n);const s=o.x/o.z*i.width+a,p=o.y/o.z*i.height+n;if(s<0||s>i.width||p<0||p>i.height)return;const f=Math.max(.5,(i.width-o.z)/i.width*3)*(1+r*.5),h=.5+(i.width-o.z)/i.width,I=e%S.length,m=S[I];let $=200+I/S.length*60;T&&($=40+I/S.length*40);const F=r>.3?.1:.3;if(!C&&h>F&&(t.beginPath(),t.moveTo(o.prevX,o.prevY),t.lineTo(s,p),t.strokeStyle=`hsla(${$}, 80%, ${60+m*30}%, ${h*(.5+r*.3)})`,t.lineWidth=f*(.5+r*.5),t.stroke()),t.beginPath(),t.arc(s,p,f,0,Math.PI*2),!C&&(h>.5||r>.4)){const k=f*(2+r*2),G=t.createRadialGradient(s,p,0,s,p,k);G.addColorStop(0,`hsla(${$}, 90%, 95%, 1)`),G.addColorStop(.3,`hsla(${$}, 80%, 80%, ${h+r*.3})`),G.addColorStop(1,"transparent"),t.fillStyle=G,t.arc(s,p,k,0,Math.PI*2)}else t.fillStyle=`hsla(${$}, 70%, ${70+h*30}%, ${h})`;t.fill()}),C||(l.shockwaves=l.shockwaves.filter(o=>(o.radius+=4+P*3,o.alpha-=.012,o.alpha<=0?!1:(t.beginPath(),t.arc(a,n,o.radius,0,Math.PI*2),t.strokeStyle=`hsla(${o.hue}, 80%, 70%, ${o.alpha})`,t.lineWidth=2+o.alpha*3,t.stroke(),t.beginPath(),t.arc(a,n,o.radius*.9,0,Math.PI*2),t.strokeStyle=`hsla(${o.hue+30}, 90%, 80%, ${o.alpha*.5})`,t.lineWidth=1,t.stroke(),!0)))),!C&&r>.5){const o=30+r*80,e=t.createRadialGradient(a,n,0,a,n,o);e.addColorStop(0,`rgba(255, 255, 255, ${r*.3})`),e.addColorStop(.3,`rgba(255, 200, 100, ${r*.15})`),e.addColorStop(1,"transparent"),t.fillStyle=e,t.beginPath(),t.arc(a,n,o,0,Math.PI*2),t.fill()}l.rotation+=.003+P*.08;const d=25+P*15+r*15;if(r>.5&&(!l.coronaExplosion||l.coronaExplosion.alpha<.3)&&(l.coronaExplosion={size:d*1.2,alpha:1,maxSize:d*5}),l.coronaExplosion){const o=l.coronaExplosion;if(o.size+=(o.maxSize-o.size)*.03,o.alpha-=.008,o.alpha>0){const e=t.createRadialGradient(a,n,d*.8,a,n,o.size);if(e.addColorStop(0,`rgba(255, 100, 50, ${o.alpha*.7})`),e.addColorStop(.3,`rgba(255, 50, 0, ${o.alpha*.5})`),e.addColorStop(.6,`rgba(200, 0, 0, ${o.alpha*.3})`),e.addColorStop(1,"transparent"),t.fillStyle=e,t.beginPath(),t.arc(a,n,o.size,0,Math.PI*2),t.fill(),!C&&o.alpha>.4)for(let s=0;s<8;s++){const p=s/8*Math.PI*2+l.rotation,g=o.size*.8,f=d*.4;t.save(),t.translate(a,n),t.rotate(p);const h=t.createLinearGradient(d,0,g,0);h.addColorStop(0,`rgba(255, 150, 50, ${o.alpha*.6})`),h.addColorStop(.5,`rgba(255, 80, 0, ${o.alpha*.4})`),h.addColorStop(1,"transparent"),t.fillStyle=h,t.beginPath(),t.moveTo(d*.8,0),t.lineTo(g,-f*.2),t.lineTo(g,f*.2),t.closePath(),t.fill(),t.restore()}}else l.coronaExplosion=null}const b=d*1.8,y=t.createRadialGradient(a,n,d*.5,a,n,b);y.addColorStop(0,`rgba(255, 120, 50, ${.6+P*.3})`),y.addColorStop(.5,`rgba(255, 60, 20, ${.3+P*.2})`),y.addColorStop(1,"transparent"),t.fillStyle=y,t.beginPath(),t.arc(a,n,b,0,Math.PI*2),t.fill();const z=t.createRadialGradient(a-d*.2,n-d*.2,0,a,n,d);if(z.addColorStop(0,"#FFF5E0"),z.addColorStop(.2,"#FFCC66"),z.addColorStop(.4,"#FF8844"),z.addColorStop(.7,"#DD4422"),z.addColorStop(1,"#AA2200"),t.fillStyle=z,t.beginPath(),t.arc(a,n,d,0,Math.PI*2),t.fill(),!C)for(let e=0;e<3;e++){const u=e/3*Math.PI*2+l.rotation*.5,s=d*.4,p=a+Math.cos(u)*s,g=n+Math.sin(u)*s,f=d*(.12+e%2*.08),h=t.createRadialGradient(p,g,0,p,g,f);h.addColorStop(0,"rgba(80, 20, 5, 0.5)"),h.addColorStop(1,"transparent"),t.fillStyle=h,t.beginPath(),t.arc(p,g,f,0,Math.PI*2),t.fill()}}export{Y as default};
