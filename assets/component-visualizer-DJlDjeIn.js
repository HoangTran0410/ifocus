import{r as u,j as n,m as be,n as we,o as ye,X as ve,R as Ce}from"./react-vendor-DAgaEvQw.js";import{u as V}from"./component-audiocontroller-CdJmNcde.js";import"./vendor-Doe1xN7X.js";let L=null,x=null,X=null,H=null,J=!1;const de={fftSize:8192,smoothingTimeConstant:.03,minDecibels:-85,maxDecibels:-22,freqStartIndex:4,freqLength:25},I={...de};function je(){return{...de}}function Me(){return{...I}}function te(e){Object.assign(I,e),x&&(e.fftSize!==void 0&&(x.fftSize=e.fftSize,X=new Uint8Array(x.frequencyBinCount)),e.smoothingTimeConstant!==void 0&&(x.smoothingTimeConstant=e.smoothingTimeConstant),e.minDecibels!==void 0&&(x.minDecibels=e.minDecibels),e.maxDecibels!==void 0&&(x.maxDecibels=e.maxDecibels))}async function Se(){if(J&&x)return!0;try{H=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser"},audio:{suppressLocalAudioPlayback:!1},selfBrowserSurface:"include",systemAudio:"include",surfaceSwitching:"include",monitorTypeSurfaces:"include"});const e=H.getAudioTracks();return e.length===0?(console.warn("No audio track in the captured stream"),O(),!1):(L=new AudioContext,x=L.createAnalyser(),x.fftSize=I.fftSize,x.smoothingTimeConstant=I.smoothingTimeConstant,x.minDecibels=I.minDecibels,x.maxDecibels=I.maxDecibels,X=new Uint8Array(x.frequencyBinCount),L.createMediaStreamSource(H).connect(x),e[0].addEventListener("ended",()=>{O()}),J=!0,!0)}catch(e){return console.error("Failed to start audio capture:",e),O(),!1}}function O(){H&&(H.getTracks().forEach(e=>e.stop()),H=null),L&&(L.close(),L=null),x=null,X=null,J=!1}function ze(){return!x||!X?new Uint8Array(64).fill(0):(x.getByteFrequencyData(X),X)}function De(e,c=3,g=1){const h=Math.floor(c/2),a=1/(2*h+1);let r=e.slice(),i=[];for(let o=0;o<g;o++){for(let s=0;s<h;s++)i[s]=r[s],i[r.length-s-1]=r[r.length-s-1];for(let s=h;s<r.length-h;s++){let m=0;for(let d=-h;d<=h;d++)m+=a*r[s+d]+d;i[s]=m}r=i}return i}function Ne(){const e=ze(),c=I.freqStartIndex,g=Math.min(c+I.freqLength,e.length),a=Array.from(e.slice(c,g)).map(r=>r/255);return De(a,5,2)}function Pe(){return J&&x!==null}const se=(e,c,g,h)=>{const a=c.width/h,r=e.createLinearGradient(0,c.height,0,0);r.addColorStop(0,"rgba(99, 102, 241, 0.8)"),r.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),r.addColorStop(1,"rgba(236, 72, 153, 0.8)"),e.fillStyle=r;for(let i=0;i<h;i++){const o=g[i]*c.height*.9,s=i*a,m=c.height-o;e.beginPath(),e.roundRect(s+1,m,a-2,o,[4,4,0,0]),e.fill()}},re=(e,c,g,h)=>{const a=c.width/(h-1),r=c.height/2,i=e.createLinearGradient(0,0,c.width,0);i.addColorStop(0,"rgba(99, 102, 241, 0.6)"),i.addColorStop(.5,"rgba(168, 85, 247, 0.6)"),i.addColorStop(1,"rgba(236, 72, 153, 0.6)"),e.fillStyle=i,e.beginPath(),e.moveTo(0,r);for(let o=0;o<h;o++){const s=o*a,m=g[o]*c.height*.4,d=r-m;if(o===0)e.lineTo(s,d);else{const C=(o-1)*a,f=(C+s)/2;e.quadraticCurveTo(C,r-g[o-1]*c.height*.4,f,(r-g[o-1]*c.height*.4+d)/2),e.quadraticCurveTo(f,d,s,d)}}for(let o=h-1;o>=0;o--){const s=o*a,m=g[o]*c.height*.4,d=r+m;if(o===h-1)e.lineTo(s,d);else{const C=(o+1)*a,f=(C+s)/2;e.quadraticCurveTo(C,r+g[o+1]*c.height*.4,f,(r+g[o+1]*c.height*.4+d)/2),e.quadraticCurveTo(f,d,s,d)}}e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(0,r);for(let o=0;o<h;o++){const s=o*a,m=g[o]*c.height*.4,d=r-m;e.lineTo(s,d)}e.stroke()},ie=(e,c,g,h)=>{const a=c.width/2,r=c.height/2,i=Math.min(a,r)*.4,o=Math.min(a,r)*.5,s=e.createRadialGradient(a,r,i,a,r,i+o);s.addColorStop(0,"rgba(99, 102, 241, 0.8)"),s.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),s.addColorStop(1,"rgba(236, 72, 153, 0.8)"),e.fillStyle=s,e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=1;for(let m=0;m<h;m++){const d=m/h*Math.PI*2-Math.PI/2,C=g[m]*o,f=a+Math.cos(d)*i,_=r+Math.sin(d)*i,R=a+Math.cos(d)*(i+C),p=r+Math.sin(d)*(i+C);e.beginPath(),e.moveTo(f,_),e.lineTo(R,p),e.lineWidth=4,e.strokeStyle=s,e.stroke()}e.beginPath(),e.arc(a,r,i*.6,0,Math.PI*2),e.fillStyle="rgba(15, 15, 25, 0.8)",e.fill(),e.strokeStyle="rgba(168, 85, 247, 0.5)",e.lineWidth=2,e.stroke()},ne=[{exponent:1,color:"#FFFFFF",smoothMargin:0,delay:0,blurRadius:5},{exponent:1.12,color:"#FFFF00",smoothMargin:2,delay:1,blurRadius:5},{exponent:1.14,color:"#FF0000",smoothMargin:2,delay:2,blurRadius:5},{exponent:1.3,color:"#FF66FF",smoothMargin:3,delay:3,blurRadius:5},{exponent:1.33,color:"#333399",smoothMargin:3,delay:4,blurRadius:5},{exponent:1.36,color:"#0000FF",smoothMargin:3,delay:5,blurRadius:5},{exponent:1.5,color:"#33CCFF",smoothMargin:5,delay:6,blurRadius:5},{exponent:1.52,color:"#00FF00",smoothMargin:5,delay:7,blurRadius:5}],oe=(e,c,g,h,a)=>{const r=c.width/2,i=c.height/2,o=Math.min(c.width,c.height)/4,s=o/5,m=Math.PI/2;a.length>=ne.length&&a.shift(),a.push([...g]);const C=g.reduce((p,D)=>p+D,0)/g.length,f=1.2,R=Math.min(1,Math.max(.3,1/(f-1)*(-Math.pow(C,f)+f*C)))*(o-s)+s;for(let p=ne.length-1;p>=0;p--){const D=ne[p],q=Math.max(a.length-D.delay-1,0),W=a[q]||g,w=[],Y=W.length;for(let N=0;N<Y;N++){const F=Math.PI*(N/(Y-1))-m,S=R+Math.pow(W[N]*o*.3,D.exponent),M=S*Math.cos(F),B=S*Math.sin(F);w.push({x:M,y:B})}e.fillStyle=D.color,e.shadowColor=D.color,e.shadowBlur=D.blurRadius,e.beginPath();for(let N=0;N<=1;N++){const F=N?-1:1;e.moveTo(r,w[0].y+i);for(let M=1;M<w.length-2;M++){const B=F*(w[M].x+w[M+1].x)/2+r,G=(w[M].y+w[M+1].y)/2+i;e.quadraticCurveTo(F*w[M].x+r,w[M].y+i,B,G)}const S=w.length-1;e.quadraticCurveTo(F*w[S-1].x+r+N*2,w[S-1].y+i,F*w[S].x+r,w[S].y+i)}e.fill()}e.shadowBlur=0},Re=["bars","wave","circular","trap-nation"],Fe={bars:"Bars",wave:"Wave",circular:"Circular","trap-nation":"Trap Nation"},ae=120,le=120,ce=400,ue=200;function Ae({onClose:e}){const c=u.useRef(null),g=u.useRef(null),h=u.useRef(0),[a,r]=V("zen_visualizer_mode","bars"),[i,o]=V("zen_visualizer_position",{x:50,y:50}),[s,m]=V("zen_visualizer_size",{width:ce,height:ue}),[d,C]=u.useState(!1),[f,_]=u.useState(null),R=u.useRef({x:0,y:0,posX:0,posY:0}),p=u.useRef({x:0,y:0,width:ce,height:ue,posX:0,posY:0}),D=u.useRef(new Array(64).fill(0)),q=u.useRef(0),W=u.useRef([]),[w,Y]=u.useState(!1),N=u.useCallback(t=>{t.stopPropagation(),r(t.target.value)},[r]),F=u.useCallback(t=>{t.stopPropagation(),e==null||e()},[e]),[S,M]=u.useState(!1),B=u.useCallback(async t=>{if(t.stopPropagation(),S)O(),M(!1);else{const l=await Se();M(l)}},[S]),[G,U]=u.useState(!1),T=u.useRef(null),P=u.useRef(null),[K,he]=u.useState(!1),[j,$]=V("zen_visualizer_config",Me());u.useEffect(()=>{te(j)},[]);const E=u.useCallback((t,l)=>{const b={...j,[t]:l};$(b),te({[t]:l})},[j,$]),ge=u.useCallback(t=>{t.stopPropagation(),he(l=>!l)},[]),pe=u.useCallback(t=>{t.stopPropagation();const l=je();$(l),te(l)},[$]),fe=u.useCallback(async t=>{if(t.stopPropagation(),!window.documentPictureInPicture){alert("Document Picture-in-Picture is not supported in your browser. Please use Chrome 116+ or Edge 116+.");return}if(T.current&&!T.current.closed){T.current.close(),T.current=null,P.current=null,U(!1);return}try{const l=await window.documentPictureInPicture.requestWindow({width:s.width,height:s.height});T.current=l,l.document.body.style.margin="0",l.document.body.style.padding="0",l.document.body.style.overflow="hidden",l.document.body.style.background="linear-gradient(135deg, rgba(15, 15, 30, 1), rgba(30, 20, 50, 1))";const b=l.document.createElement("canvas");b.width=s.width,b.height=s.height,b.style.width="100%",b.style.height="100%",l.document.body.appendChild(b),P.current=b,l.addEventListener("pagehide",()=>{T.current=null,P.current=null,U(!1)}),U(!0)}catch(l){console.error("PiP error:",l),alert("Failed to activate Picture-in-Picture mode. Error: "+l.message),U(!1)}},[s]);u.useEffect(()=>()=>{T.current&&!T.current.closed&&T.current.close(),O()},[]);const me=u.useCallback(t=>{t.target.classList.contains("resize-handle")||(t.preventDefault(),C(!0),R.current={x:t.clientX,y:t.clientY,posX:i.x,posY:i.y})},[i]),Q=u.useCallback(t=>{if(d){const l=t.clientX-R.current.x,b=t.clientY-R.current.y;o({x:Math.max(0,Math.min(window.innerWidth-s.width,R.current.posX+l)),y:Math.max(0,Math.min(window.innerHeight-s.height,R.current.posY+b))})}else if(f){const l=t.clientX-p.current.x,b=t.clientY-p.current.y;let v=p.current.width,z=p.current.height,y=p.current.posX,ee=p.current.posY;if(f.includes("e")&&(v=Math.max(ae,p.current.width+l)),f.includes("w")){const A=p.current.width-l;A>=ae&&(v=A,y=p.current.posX+l)}if(f.includes("s")&&(z=Math.max(le,p.current.height+b)),f.includes("n")){const A=p.current.height-b;A>=le&&(z=A,ee=p.current.posY+b)}m({width:v,height:z}),o({x:y,y:ee})}},[d,f,s.width,s.height]),Z=u.useCallback(()=>{C(!1),_(null)},[]);u.useEffect(()=>{if(d||f)return window.addEventListener("mousemove",Q),window.addEventListener("mouseup",Z),()=>{window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",Z)}},[d,f,Q,Z]);const k=u.useCallback((t,l)=>{t.preventDefault(),t.stopPropagation(),_(l),p.current={x:t.clientX,y:t.clientY,width:s.width,height:s.height,posX:i.x,posY:i.y}},[s,i]);u.useEffect(()=>{const t=c.current;if(!t)return;const l=t.getContext("2d");if(!l)return;const b=()=>{q.current+=.02;let v;if(Pe())v=Ne();else{for(let y=0;y<D.current.length;y++){const A=.3+(Math.sin(q.current*2+y*.3)*.3+Math.sin(q.current*3.5+y*.5)*.2+Math.sin(q.current*1.2+y*.7)*.25)*.5;D.current[y]=Math.max(0,Math.min(1,A+Math.random()*.1))}v=D.current}l.clearRect(0,0,t.width,t.height);const z=v.length;if(a==="bars"?se(l,t,v,z):a==="wave"?re(l,t,v,z):a==="circular"?ie(l,t,v,z):a==="trap-nation"&&oe(l,t,v,z,W.current),P.current){const y=P.current.getContext("2d");y&&(y.clearRect(0,0,P.current.width,P.current.height),a==="bars"?se(y,P.current,v,z):a==="wave"?re(y,P.current,v,z):a==="circular"?ie(y,P.current,v,z):a==="trap-nation"&&oe(y,P.current,v,z,W.current))}h.current=requestAnimationFrame(b)};return b(),()=>{cancelAnimationFrame(h.current)}},[a,s,G]);const xe=()=>n.jsx("div",{className:"absolute top-10 left-0 right-0 z-20 p-3 mx-2 rounded-lg",style:{background:"rgba(15, 15, 30, 0.45)",border:"1px solid rgba(168, 85, 247, 0.3)",maxHeight:s.height-50,overflowY:"auto"},onMouseDown:t=>t.stopPropagation(),children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:n.jsx("span",{children:"FFT Size"})}),n.jsx("select",{value:j.fftSize,onChange:t=>E("fftSize",parseInt(t.target.value)),className:"w-full px-2 py-1 text-xs bg-white/10 text-white/90 rounded-md border border-white/20 cursor-pointer focus:outline-none focus:border-purple-500",children:[32,64,128,256,512,1024,2048,4096,8192,16384,32768].map(t=>n.jsx("option",{value:t,className:"bg-gray-900",children:t},t))})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Smoothing"}),n.jsx("span",{className:"text-purple-400",children:j.smoothingTimeConstant.toFixed(2)})]}),n.jsx("input",{type:"range",min:"0",max:"0.99",step:"0.01",value:j.smoothingTimeConstant,onChange:t=>E("smoothingTimeConstant",parseFloat(t.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Min dB"}),n.jsx("span",{className:"text-purple-400",children:j.minDecibels})]}),n.jsx("input",{type:"range",min:"-100",max:"-30",step:"1",value:j.minDecibels,onChange:t=>E("minDecibels",parseInt(t.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Max dB"}),n.jsx("span",{className:"text-purple-400",children:j.maxDecibels})]}),n.jsx("input",{type:"range",min:"-50",max:"0",step:"1",value:j.maxDecibels,onChange:t=>E("maxDecibels",parseInt(t.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Freq Start"}),n.jsx("span",{className:"text-purple-400",children:j.freqStartIndex})]}),n.jsx("input",{type:"range",min:"0",max:"1024",step:"1",value:j.freqStartIndex,onChange:t=>E("freqStartIndex",parseInt(t.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Freq Count"}),n.jsx("span",{className:"text-purple-400",children:j.freqLength})]}),n.jsx("input",{type:"range",min:"5",max:"1024",step:"1",value:j.freqLength,onChange:t=>E("freqLength",parseInt(t.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("button",{onClick:pe,className:"w-full mt-2 px-3 py-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer flex items-center justify-center gap-2",title:"Reset to defaults",children:[n.jsx(Ce,{size:14}),"Reset to Defaults"]})]})});return n.jsx("div",{ref:g,className:"fixed cursor-move select-none",style:{left:i.x,top:i.y,width:s.width,height:s.height,zIndex:9999},onMouseDown:me,onMouseEnter:()=>Y(!0),onMouseLeave:()=>Y(!1),children:n.jsxs("div",{className:"relative w-full h-full rounded-2xl overflow-hidden backdrop-blur-md transition-opacity duration-300",style:{background:"linear-gradient(135deg, rgba(15, 15, 30, 0.85), rgba(30, 20, 50, 0.85))",border:"1px solid rgba(168, 85, 247, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(168, 85, 247, 0.1)"},children:[n.jsxs("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-between px-3 py-2 z-10 transition-opacity duration-300",style:{background:"linear-gradient(180deg, rgba(0,0,0,0.4), transparent)",opacity:K||w?1:.4},children:[n.jsx("span",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Visualizer"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:B,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${S?"text-green-400 bg-green-500/20 hover:bg-green-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:S?"Stop audio capture":"Capture tab audio",children:n.jsx(be,{size:14})}),n.jsx("button",{onClick:fe,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${G?"text-purple-400 bg-purple-500/20 hover:bg-purple-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:G?"Close PiP":"Open in PiP",children:n.jsx(we,{size:14})}),n.jsx("button",{onClick:ge,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${K?"text-amber-400 bg-amber-500/20 hover:bg-amber-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:"Audio analyzer settings",children:n.jsx(ye,{size:14})}),n.jsx("select",{value:a,onChange:N,onMouseDown:t=>t.stopPropagation(),className:"px-2 py-1 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer border-none focus:outline-none",children:Re.map(t=>n.jsx("option",{value:t,className:"bg-gray-900 text-white",children:Fe[t]},t))}),n.jsx("button",{onClick:F,className:"p-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-red-500/30 hover:text-red-400 rounded-md transition-colors cursor-pointer",title:"Close visualizer",children:n.jsx(ve,{size:14})})]})]}),K&&xe(),n.jsx("canvas",{ref:c,width:s.width,height:s.height,className:"w-full h-full"}),n.jsx("div",{className:"resize-handle absolute top-0 left-0 w-4 h-4 cursor-nw-resize",onMouseDown:t=>k(t,"nw")}),n.jsx("div",{className:"resize-handle absolute top-0 right-0 w-4 h-4 cursor-ne-resize",onMouseDown:t=>k(t,"ne")}),n.jsx("div",{className:"resize-handle absolute bottom-0 left-0 w-4 h-4 cursor-sw-resize",onMouseDown:t=>k(t,"sw")}),n.jsx("div",{className:"resize-handle absolute bottom-0 right-0 w-4 h-4 cursor-se-resize",onMouseDown:t=>k(t,"se")}),n.jsx("div",{className:"resize-handle absolute top-0 left-4 right-4 h-2 cursor-n-resize",onMouseDown:t=>k(t,"n")}),n.jsx("div",{className:"resize-handle absolute bottom-0 left-4 right-4 h-2 cursor-s-resize",onMouseDown:t=>k(t,"s")}),n.jsx("div",{className:"resize-handle absolute left-0 top-4 bottom-4 w-2 cursor-w-resize",onMouseDown:t=>k(t,"w")}),n.jsx("div",{className:"resize-handle absolute right-0 top-4 bottom-4 w-2 cursor-e-resize",onMouseDown:t=>k(t,"e")})]})})}export{Ae as default};
