const a={particles:[],rockets:[],lastBeatTime:0,lastAmbientTime:0,beatFlash:0,lastCanvasHeight:0},B=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FF69B4","#00CED1","#FFD700","#FF4500"];function S(){return B[Math.floor(Math.random()*B.length)]}function T({ctx:l,canvas:i,data:y,performanceMode:o=!1,beatIntensity:d=0}){const b=y.reduce((e,t)=>e+t,0)/y.length,F=o?150:400,f=Date.now(),p=8,u=.15,R=4,P=.1,C=i.width/2,c=i.height/2;if(Math.abs(i.height-a.lastCanvasHeight)>50&&(a.rockets.length=0,a.particles.length=0,a.lastCanvasHeight=i.height),a.beatFlash>0&&(a.beatFlash-=.05),d>.3&&f-a.lastBeatTime>200){a.lastBeatTime=f,a.beatFlash=d;const e=Math.ceil(2+d*3);for(let t=0;t<e;t++)a.rockets.push({x:i.width*(.1+Math.random()*.8),y:i.height,vy:-(p+d*4+Math.random()*3),targetY:i.height*(.15+Math.random()*.35),color:S(),trail:[],isBeatRocket:!0})}if(b>.2&&f-a.lastAmbientTime>400&&(a.lastAmbientTime=f,a.rockets.push({x:i.width*(.15+Math.random()*.7),y:i.height,vy:-(p*.7+Math.random()*2),targetY:i.height*(.25+Math.random()*.35),color:S(),trail:[],isBeatRocket:!1})),a.beatFlash>0&&!o){const e=l.createRadialGradient(C,c,0,C,c,Math.max(i.width,i.height)*.6);e.addColorStop(0,`rgba(255, 200, 100, ${a.beatFlash*.3})`),e.addColorStop(.5,`rgba(255, 100, 50, ${a.beatFlash*.15})`),e.addColorStop(1,"transparent"),l.fillStyle=e,l.fillRect(0,0,i.width,i.height)}for(let e=a.rockets.length-1;e>=0;e--){const t=a.rockets[e];if(t.trail.push({x:t.x,y:t.y}),t.trail.length>12&&t.trail.shift(),t.y+=t.vy,t.vy+=u,!o&&t.trail.length>1){l.beginPath(),l.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(n=>l.lineTo(n.x,n.y));const r=l.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);r.addColorStop(0,"transparent"),r.addColorStop(1,t.color),l.strokeStyle=r,l.lineWidth=t.isBeatRocket?3:2,l.stroke()}const h=t.isBeatRocket?4:3;if(o||(l.shadowColor=t.color,l.shadowBlur=15),l.beginPath(),l.arc(t.x,t.y,h,0,Math.PI*2),l.fillStyle="#FFF",l.fill(),l.shadowBlur=0,t.y<=t.targetY||t.vy>=0){const r=o?25:60,n=t.isBeatRocket?r*1.5:r,m=t.isBeatRocket?1.3:1;for(let g=0;g<n&&a.particles.length<F;g++){const s=Math.PI*2*g/n+Math.random()*.3,k=(R+Math.random()*3)*m;a.particles.push({x:t.x,y:t.y,vx:Math.cos(s)*k,vy:Math.sin(s)*k,life:1,maxLife:1,color:t.color,size:t.isBeatRocket?4:3,trail:[],isBeatParticle:t.isBeatRocket})}if(t.isBeatRocket&&!o){l.beginPath(),l.arc(t.x,t.y,40,0,Math.PI*2);const s=l.createRadialGradient(t.x,t.y,0,t.x,t.y,40);s.addColorStop(0,"rgba(255, 255, 255, 0.8)"),s.addColorStop(.5,`${t.color}80`),s.addColorStop(1,"transparent"),l.fillStyle=s,l.fill()}a.rockets.splice(e,1)}}for(let e=a.particles.length-1;e>=0;e--){const t=a.particles[e];if(o||(t.trail.push({x:t.x,y:t.y}),t.trail.length>6&&t.trail.shift()),t.x+=t.vx,t.y+=t.vy,t.vy+=P,t.vx*=.98,t.vy*=.98,t.life-=t.isBeatParticle?.015:.02,t.life<=0){a.particles.splice(e,1);continue}const h=t.life;!o&&t.trail.length>1&&(l.beginPath(),l.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(r=>l.lineTo(r.x,r.y)),l.globalAlpha=h*.5,l.strokeStyle=t.color,l.lineWidth=t.size*.4,l.stroke(),l.globalAlpha=1),l.beginPath(),l.arc(t.x,t.y,t.size*h,0,Math.PI*2),l.globalAlpha=h,l.fillStyle=t.color,!o&&t.isBeatParticle&&h>.4&&(l.shadowColor=t.color,l.shadowBlur=8),l.fill(),l.shadowBlur=0,l.globalAlpha=1}}export{T as default};
