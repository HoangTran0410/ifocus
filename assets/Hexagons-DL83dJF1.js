const o={time:0,pulses:[],lastBeat:0},w=Array.from({length:6},(s,n)=>({cos:Math.cos(Math.PI/3*n-Math.PI/6),sin:Math.sin(Math.PI/3*n-Math.PI/6)}));function j(s,n,l,a){s.beginPath(),s.moveTo(n+a*w[0].cos,l+a*w[0].sin);for(let c=1;c<6;c++)s.lineTo(n+a*w[c].cos,l+a*w[c].sin);s.closePath()}function K({ctx:s,canvas:n,data:l,performanceMode:a=!1,beatIntensity:c=0,bass:W=0,high:J=0}){const i=n.width,r=n.height,y=l.reduce((t,e)=>t+e,0)/l.length;o.time+=.03+y*.02;const d=Date.now();W>.4&&d-o.lastBeat>150&&(o.pulses.push({x:Math.random()*i,y:Math.random()*r,startTime:d}),o.lastBeat=d),o.pulses=o.pulses.filter(t=>d-t.startTime<1500);const b=a?3:6;o.pulses.length>b&&(o.pulses=o.pulses.slice(-b));const h=a?45:35,P=h*2,x=h*1.732,C=Math.ceil(i/(P*.75))+2,T=Math.ceil(r/(x*.5))+2,u=i/2,f=r/2,_=Math.sqrt(u*u+f*f),B=o.pulses.map(t=>{const e=(d-t.startTime)/1e3;return{x:t.x,y:t.y,radius:e*350,alpha:1-e/1.5}}).filter(t=>t.alpha>0);s.shadowBlur=0;for(let t=-1;t<T;t++){const e=t%2===0?0:P*.375,p=t*x*.5;for(let m=-1;m<C;m++){const g=m*P*.75+e;if(g<-h||g>i+h||p<-h||p>r+h)continue;const D=g-u,G=p-f,H=Math.sqrt(D*D+G*G)/_,z=Math.floor((m+t)/(C+T)*l.length),S=l[Math.abs(z)%l.length]||y;let M=0;for(const $ of B){const X=g-$.x,k=p-$.y,Y=Math.sqrt(X*X+k*k),A=Math.abs(Y-$.radius);A<60&&(M=Math.max(M,(1-A/60)*$.alpha))}const F=Math.sin(o.time+H*2)*.15,I=S+F,L=.75+I*.35+M*.25,N=h*L,R=220+H*50+S*35,q=65+S*35,v=35+I*30+M*20,E=.45+I*.45+M*.25;j(s,g,p,N),s.fillStyle=`hsla(${R}, ${q}%, ${v}%, ${E})`,s.fill(),s.strokeStyle=`hsla(${R+25}, ${q+15}%, ${v+15}%, ${E*.9})`,s.lineWidth=1+S*.5,s.stroke()}}if(!a)for(const t of B){const e=s.createRadialGradient(t.x,t.y,Math.max(0,t.radius-40),t.x,t.y,t.radius+40);e.addColorStop(0,"transparent"),e.addColorStop(.4,`rgba(100, 150, 255, ${t.alpha*.3})`),e.addColorStop(.6,`rgba(150, 100, 255, ${t.alpha*.3})`),e.addColorStop(1,"transparent"),s.fillStyle=e,s.fillRect(0,0,i,r)}if(!a&&y>.2){const t=s.createRadialGradient(u,f,0,u,f,Math.max(i,r)/3);t.addColorStop(0,`rgba(100, 150, 255, ${y*.12})`),t.addColorStop(1,"transparent"),s.fillStyle=t,s.fillRect(0,0,i,r)}}export{K as default};
