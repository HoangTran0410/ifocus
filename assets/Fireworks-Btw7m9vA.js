const l={particles:[],rockets:[],lastBeatTime:0,lastAmbientTime:0,beatFlash:0,lastCanvasHeight:0},B=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FF69B4","#00CED1","#FFD700","#FF4500"];function S(){return B[Math.floor(Math.random()*B.length)]}function w({ctx:e,canvas:i,data:y,performanceMode:o=!1,beatIntensity:T=0,bass:d=0}){const b=y.reduce((a,t)=>a+t,0)/y.length,F=o?150:400,f=Date.now(),p=8,u=.15,R=4,P=.1,C=i.width/2,c=i.height/2;if(Math.abs(i.height-l.lastCanvasHeight)>50&&(l.rockets.length=0,l.particles.length=0,l.lastCanvasHeight=i.height),l.beatFlash>0&&(l.beatFlash-=.05),d>.25&&f-l.lastBeatTime>200){l.lastBeatTime=f,l.beatFlash=d;const a=Math.ceil(2+d*4);for(let t=0;t<a;t++)l.rockets.push({x:i.width*(.1+Math.random()*.8),y:i.height,vy:-(p+d*5+Math.random()*3),targetY:i.height*(.15+Math.random()*.35),color:S(),trail:[],isBeatRocket:!0})}if(b>.2&&f-l.lastAmbientTime>400&&(l.lastAmbientTime=f,l.rockets.push({x:i.width*(.15+Math.random()*.7),y:i.height,vy:-(p*.7+Math.random()*2),targetY:i.height*(.25+Math.random()*.35),color:S(),trail:[],isBeatRocket:!1})),l.beatFlash>0&&!o){const a=e.createRadialGradient(C,c,0,C,c,Math.max(i.width,i.height)*.6);a.addColorStop(0,`rgba(255, 200, 100, ${l.beatFlash*.5})`),a.addColorStop(.5,`rgba(255, 100, 50, ${l.beatFlash*.15})`),a.addColorStop(1,"transparent"),e.fillStyle=a,e.fillRect(0,0,i.width,i.height)}for(let a=l.rockets.length-1;a>=0;a--){const t=l.rockets[a];if(t.trail.push({x:t.x,y:t.y}),t.trail.length>12&&t.trail.shift(),t.y+=t.vy,t.vy+=u,!o&&t.trail.length>1){e.beginPath(),e.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(n=>e.lineTo(n.x,n.y));const r=e.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);r.addColorStop(0,"transparent"),r.addColorStop(1,t.color),e.strokeStyle=r,e.lineWidth=t.isBeatRocket?3:2,e.stroke()}const s=t.isBeatRocket?4:3;if(o||(e.shadowColor=t.color,e.shadowBlur=15),e.beginPath(),e.arc(t.x,t.y,s,0,Math.PI*2),e.fillStyle="#FFF",e.fill(),e.shadowBlur=0,t.y<=t.targetY||t.vy>=0){const r=o?25:60,n=t.isBeatRocket?r*1.5:r,m=t.isBeatRocket?1.3:1;for(let g=0;g<n&&l.particles.length<F;g++){const h=Math.PI*2*g/n+Math.random()*.3,k=(R+Math.random()*3)*m;l.particles.push({x:t.x,y:t.y,vx:Math.cos(h)*k,vy:Math.sin(h)*k,life:1,maxLife:1,color:t.color,size:t.isBeatRocket?4:3,trail:[],isBeatParticle:t.isBeatRocket})}if(t.isBeatRocket&&!o){e.beginPath(),e.arc(t.x,t.y,40,0,Math.PI*2);const h=e.createRadialGradient(t.x,t.y,0,t.x,t.y,40);h.addColorStop(0,"rgba(255, 255, 255, 0.8)"),h.addColorStop(.5,`${t.color}80`),h.addColorStop(1,"transparent"),e.fillStyle=h,e.fill()}l.rockets.splice(a,1)}}for(let a=l.particles.length-1;a>=0;a--){const t=l.particles[a];if(o||(t.trail.push({x:t.x,y:t.y}),t.trail.length>6&&t.trail.shift()),t.x+=t.vx,t.y+=t.vy,t.vy+=P,t.vx*=.98,t.vy*=.98,t.life-=t.isBeatParticle?.015:.02,t.life<=0){l.particles.splice(a,1);continue}const s=t.life;!o&&t.trail.length>1&&(e.beginPath(),e.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(r=>e.lineTo(r.x,r.y)),e.globalAlpha=s*.5,e.strokeStyle=t.color,e.lineWidth=t.size*.4,e.stroke(),e.globalAlpha=1),e.beginPath(),e.arc(t.x,t.y,t.size*s,0,Math.PI*2),e.globalAlpha=s,e.fillStyle=t.color,!o&&t.isBeatParticle&&s>.4&&(e.shadowColor=t.color,e.shadowBlur=8),e.fill(),e.shadowBlur=0,e.globalAlpha=1}}export{w as default};
