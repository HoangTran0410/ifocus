import{r as d,j as n,m as je,n as Se,o as Ce,p as ze,q as Me,X as Ne,R as De}from"./react-vendor-BfW9shI7.js";import{u as J}from"./component-audiocontroller-Cq-fsp9z.js";import"./vendor-2Ktpr_8P.js";let H=null,x=null,W=null,_=null,K=!1;const pe={fftSize:8192,smoothingTimeConstant:.03,minDecibels:-85,maxDecibels:-22,freqStartIndex:4,freqLength:25},q={...pe};function Pe(){return{...pe}}function Re(){return{...q}}function se(t){Object.assign(q,t),x&&(t.fftSize!==void 0&&(x.fftSize=t.fftSize,W=new Uint8Array(x.frequencyBinCount)),t.smoothingTimeConstant!==void 0&&(x.smoothingTimeConstant=t.smoothingTimeConstant),t.minDecibels!==void 0&&(x.minDecibels=t.minDecibels),t.maxDecibels!==void 0&&(x.maxDecibels=t.maxDecibels))}async function Fe(){if(K&&x)return!0;try{_=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser"},audio:{suppressLocalAudioPlayback:!1},selfBrowserSurface:"include",systemAudio:"include",surfaceSwitching:"include",monitorTypeSurfaces:"include"});const t=_.getAudioTracks();return t.length===0?(console.warn("No audio track in the captured stream"),B(),!1):(H=new AudioContext,x=H.createAnalyser(),x.fftSize=q.fftSize,x.smoothingTimeConstant=q.smoothingTimeConstant,x.minDecibels=q.minDecibels,x.maxDecibels=q.maxDecibels,W=new Uint8Array(x.frequencyBinCount),H.createMediaStreamSource(_).connect(x),t[0].addEventListener("ended",()=>{B()}),K=!0,!0)}catch(t){return console.error("Failed to start audio capture:",t),B(),!1}}function B(){_&&(_.getTracks().forEach(t=>t.stop()),_=null),H&&(H.close(),H=null),x=null,W=null,K=!1}function Te(){return!x||!W?new Uint8Array(64).fill(0):(x.getByteFrequencyData(W),W)}function ke(t,a=3,m=1){const h=Math.floor(a/2),g=1/(2*h+1);let r=t.slice(),c=[];for(let i=0;i<m;i++){for(let s=0;s<h;s++)c[s]=r[s],c[r.length-s-1]=r[r.length-s-1];for(let s=h;s<r.length-h;s++){let f=0;for(let u=-h;u<=h;u++)f+=g*r[s+u]+u;c[s]=f}r=c}return c}function Ie(){const t=Te(),a=q.freqStartIndex,m=Math.min(a+q.freqLength,t.length),g=Array.from(t.slice(a,m)).map(r=>r/255);return ke(g,5,2)}function Ae(){return K&&x!==null}const oe=(t,a,m,h)=>{const g=a.width/h,r=t.createLinearGradient(0,a.height,0,0);r.addColorStop(0,"rgba(99, 102, 241, 0.8)"),r.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),r.addColorStop(1,"rgba(236, 72, 153, 0.8)"),t.fillStyle=r;for(let c=0;c<h;c++){const i=m[c]*a.height*.9,s=c*g,f=a.height-i;t.beginPath(),t.roundRect(s+1,f,g-2,i,[4,4,0,0]),t.fill()}},ae=(t,a,m,h)=>{const g=a.width/(h-1),r=a.height/2,c=t.createLinearGradient(0,0,a.width,0);c.addColorStop(0,"rgba(99, 102, 241, 0.6)"),c.addColorStop(.5,"rgba(168, 85, 247, 0.6)"),c.addColorStop(1,"rgba(236, 72, 153, 0.6)"),t.fillStyle=c,t.beginPath(),t.moveTo(0,r);for(let i=0;i<h;i++){const s=i*g,f=m[i]*a.height*.4,u=r-f;if(i===0)t.lineTo(s,u);else{const S=(i-1)*g,l=(S+s)/2;t.quadraticCurveTo(S,r-m[i-1]*a.height*.4,l,(r-m[i-1]*a.height*.4+u)/2),t.quadraticCurveTo(l,u,s,u)}}for(let i=h-1;i>=0;i--){const s=i*g,f=m[i]*a.height*.4,u=r+f;if(i===h-1)t.lineTo(s,u);else{const S=(i+1)*g,l=(S+s)/2;t.quadraticCurveTo(S,r+m[i+1]*a.height*.4,l,(r+m[i+1]*a.height*.4+u)/2),t.quadraticCurveTo(l,u,s,u)}}t.closePath(),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=2,t.beginPath(),t.moveTo(0,r);for(let i=0;i<h;i++){const s=i*g,f=m[i]*a.height*.4,u=r-f;t.lineTo(s,u)}t.stroke()},le=(t,a,m,h)=>{const g=a.width/2,r=a.height/2,c=Math.min(g,r)*.4,i=Math.min(g,r)*.5,s=t.createRadialGradient(g,r,c,g,r,c+i);s.addColorStop(0,"rgba(99, 102, 241, 0.8)"),s.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),s.addColorStop(1,"rgba(236, 72, 153, 0.8)"),t.fillStyle=s,t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1;for(let f=0;f<h;f++){const u=f/h*Math.PI*2-Math.PI/2,S=m[f]*i,l=g+Math.cos(u)*c,G=r+Math.sin(u)*c,k=g+Math.cos(u)*(c+S),P=r+Math.sin(u)*(c+S);t.beginPath(),t.moveTo(l,G),t.lineTo(k,P),t.lineWidth=4,t.strokeStyle=s,t.stroke()}t.beginPath(),t.arc(g,r,c*.6,0,Math.PI*2),t.fillStyle="rgba(15, 15, 25, 0.8)",t.fill(),t.strokeStyle="rgba(168, 85, 247, 0.5)",t.lineWidth=2,t.stroke()},re=[{exponent:1,color:"#FFFFFF",smoothMargin:0,delay:0,blurRadius:5},{exponent:1.12,color:"#FFFF00",smoothMargin:2,delay:1,blurRadius:5},{exponent:1.14,color:"#FF0000",smoothMargin:2,delay:2,blurRadius:5},{exponent:1.3,color:"#FF66FF",smoothMargin:3,delay:3,blurRadius:5},{exponent:1.33,color:"#333399",smoothMargin:3,delay:4,blurRadius:5},{exponent:1.36,color:"#0000FF",smoothMargin:3,delay:5,blurRadius:5},{exponent:1.5,color:"#33CCFF",smoothMargin:5,delay:6,blurRadius:5},{exponent:1.52,color:"#00FF00",smoothMargin:5,delay:7,blurRadius:5}],ce=(t,a,m,h,g)=>{const r=a.width/2,c=a.height/2,i=Math.min(a.width,a.height)/4,s=i/5,f=Math.PI/2;g.length>=re.length&&g.shift(),g.push([...m]);const S=m.reduce((P,w)=>P+w,0)/m.length,l=1.2,k=Math.min(1,Math.max(.3,1/(l-1)*(-Math.pow(S,l)+l*S)))*(i-s)+s;for(let P=re.length-1;P>=0;P--){const w=re[P],O=Math.max(g.length-w.delay-1,0),I=g[O]||m,p=[],L=I.length;for(let C=0;C<L;C++){const R=Math.PI*(C/(L-1))-f,v=k+Math.pow(I[C]*i*.3,w.exponent),M=v*Math.cos(R),Y=v*Math.sin(R);p.push({x:M,y:Y})}t.fillStyle=w.color,t.shadowColor=w.color,t.shadowBlur=w.blurRadius,t.beginPath();for(let C=0;C<=1;C++){const R=C?-1:1;t.moveTo(r,p[0].y+c);for(let M=1;M<p.length-2;M++){const Y=R*(p[M].x+p[M+1].x)/2+r,Q=(p[M].y+p[M+1].y)/2+c;t.quadraticCurveTo(R*p[M].x+r,p[M].y+c,Y,Q)}const v=p.length-1;t.quadraticCurveTo(R*p[v-1].x+r+C*2,p[v-1].y+c,R*p[v].x+r,p[v].y+c)}t.fill()}t.shadowBlur=0},qe=["bars","wave","circular","trap-nation"],Ee={bars:"Bars",wave:"Wave",circular:"Circular","trap-nation":"Trap Nation"},ue=120,de=120,he=400,ge=200;function We({onClose:t,displayMode:a="window",setDisplayMode:m,isCenterMode:h=!1,allowPiP:g=!0}){const r=d.useRef(null),c=d.useRef(null),i=d.useRef(0),[s,f]=J("zen_visualizer_mode","bars"),[u,S]=J("zen_visualizer_position",{x:50,y:50}),[l,G]=J("zen_visualizer_size",{width:he,height:ge}),[k,P]=d.useState(!1),[w,O]=d.useState(null),I=d.useRef({x:0,y:0,posX:0,posY:0}),p=d.useRef({x:0,y:0,width:he,height:ge,posX:0,posY:0}),L=d.useRef(new Array(64).fill(0)),C=d.useRef(0),R=d.useRef([]),[v,M]=d.useState(!1),Y=d.useCallback(e=>{e.stopPropagation(),f(e.target.value)},[f]),Q=d.useCallback(e=>{e.stopPropagation(),t==null||t()},[t]),[U,ie]=d.useState(!1),me=d.useCallback(async e=>{if(e.stopPropagation(),U)B(),ie(!1);else{const o=await Fe();ie(o)}},[U]),[Z,$]=d.useState(!1),F=d.useRef(null),D=d.useRef(null),[T,fe]=d.useState(!1),[z,V]=J("zen_visualizer_config",Re());d.useEffect(()=>{se(z)},[]);const X=d.useCallback((e,o)=>{const b={...z,[e]:o};V(b),se({[e]:o})},[z,V]),xe=d.useCallback(e=>{e.stopPropagation(),fe(o=>!o)},[]),be=d.useCallback(e=>{e.stopPropagation();const o=Pe();V(o),se(o)},[V]),we=d.useCallback(async e=>{if(e.stopPropagation(),!window.documentPictureInPicture){alert("Document Picture-in-Picture is not supported in your browser. Please use Chrome 116+ or Edge 116+.");return}if(F.current&&!F.current.closed){F.current.close(),F.current=null,D.current=null,$(!1);return}try{const o=await window.documentPictureInPicture.requestWindow({width:l.width,height:l.height});F.current=o,o.document.body.style.margin="0",o.document.body.style.padding="0",o.document.body.style.overflow="hidden",o.document.body.style.background="linear-gradient(135deg, rgba(15, 15, 30, 1), rgba(30, 20, 50, 1))";const b=o.document.createElement("canvas");b.width=l.width,b.height=l.height,b.style.width="100%",b.style.height="100%",o.document.body.appendChild(b),D.current=b,o.addEventListener("pagehide",()=>{F.current=null,D.current=null,$(!1)}),$(!0)}catch(o){console.error("PiP error:",o),alert("Failed to activate Picture-in-Picture mode. Error: "+o.message),$(!1)}},[l]);d.useEffect(()=>()=>{F.current&&!F.current.closed&&F.current.close(),B()},[]);const ye=d.useCallback(e=>{e.target.classList.contains("resize-handle")||(e.preventDefault(),P(!0),I.current={x:e.clientX,y:e.clientY,posX:u.x,posY:u.y})},[u]),ee=d.useCallback(e=>{if(k){const o=e.clientX-I.current.x,b=e.clientY-I.current.y;S({x:Math.max(0,Math.min(window.innerWidth-l.width,I.current.posX+o)),y:Math.max(0,Math.min(window.innerHeight-l.height,I.current.posY+b))})}else if(w){const o=e.clientX-p.current.x,b=e.clientY-p.current.y;let j=p.current.width,N=p.current.height,y=p.current.posX,ne=p.current.posY;if(w.includes("e")&&(j=Math.max(ue,p.current.width+o)),w.includes("w")){const E=p.current.width-o;E>=ue&&(j=E,y=p.current.posX+o)}if(w.includes("s")&&(N=Math.max(de,p.current.height+b)),w.includes("n")){const E=p.current.height-b;E>=de&&(N=E,ne=p.current.posY+b)}G({width:j,height:N}),S({x:y,y:ne})}},[k,w,l.width,l.height]),te=d.useCallback(()=>{P(!1),O(null)},[]);d.useEffect(()=>{if(k||w)return window.addEventListener("mousemove",ee),window.addEventListener("mouseup",te),()=>{window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",te)}},[k,w,ee,te]);const A=d.useCallback((e,o)=>{e.preventDefault(),e.stopPropagation(),O(o),p.current={x:e.clientX,y:e.clientY,width:l.width,height:l.height,posX:u.x,posY:u.y}},[l,u]);d.useEffect(()=>{const e=r.current;if(!e)return;const o=e.getContext("2d");if(!o)return;const b=()=>{C.current+=.02;let j;if(Ae())j=Ie();else{for(let y=0;y<L.current.length;y++){const E=.3+(Math.sin(C.current*2+y*.3)*.3+Math.sin(C.current*3.5+y*.5)*.2+Math.sin(C.current*1.2+y*.7)*.25)*.5;L.current[y]=Math.max(0,Math.min(1,E+Math.random()*.1))}j=L.current}o.clearRect(0,0,e.width,e.height);const N=j.length;if(s==="bars"?oe(o,e,j,N):s==="wave"?ae(o,e,j,N):s==="circular"?le(o,e,j,N):s==="trap-nation"&&ce(o,e,j,N,R.current),D.current){const y=D.current.getContext("2d");y&&(y.clearRect(0,0,D.current.width,D.current.height),s==="bars"?oe(y,D.current,j,N):s==="wave"?ae(y,D.current,j,N):s==="circular"?le(y,D.current,j,N):s==="trap-nation"&&ce(y,D.current,j,N,R.current))}i.current=requestAnimationFrame(b)};return b(),()=>{cancelAnimationFrame(i.current)}},[s,l,Z]);const ve=()=>n.jsx("div",{className:"absolute top-10 left-0 right-0 z-20 p-3 mx-2 rounded-lg",style:{background:"rgba(15, 15, 30, 0.45)",border:"1px solid rgba(168, 85, 247, 0.3)",maxHeight:l.height-50,overflowY:"auto"},onMouseDown:e=>e.stopPropagation(),children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:n.jsx("span",{children:"FFT Size"})}),n.jsx("select",{value:z.fftSize,onChange:e=>X("fftSize",parseInt(e.target.value)),className:"w-full px-2 py-1 text-xs bg-white/10 text-white/90 rounded-md border border-white/20 cursor-pointer focus:outline-none focus:border-purple-500",children:[32,64,128,256,512,1024,2048,4096,8192,16384,32768].map(e=>n.jsx("option",{value:e,className:"bg-gray-900",children:e},e))})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Smoothing"}),n.jsx("span",{className:"text-purple-400",children:z.smoothingTimeConstant.toFixed(2)})]}),n.jsx("input",{type:"range",min:"0",max:"0.99",step:"0.01",value:z.smoothingTimeConstant,onChange:e=>X("smoothingTimeConstant",parseFloat(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Min dB"}),n.jsx("span",{className:"text-purple-400",children:z.minDecibels})]}),n.jsx("input",{type:"range",min:"-100",max:"-30",step:"1",value:z.minDecibels,onChange:e=>X("minDecibels",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Max dB"}),n.jsx("span",{className:"text-purple-400",children:z.maxDecibels})]}),n.jsx("input",{type:"range",min:"-50",max:"0",step:"1",value:z.maxDecibels,onChange:e=>X("maxDecibels",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Freq Start"}),n.jsx("span",{className:"text-purple-400",children:z.freqStartIndex})]}),n.jsx("input",{type:"range",min:"0",max:"1024",step:"1",value:z.freqStartIndex,onChange:e=>X("freqStartIndex",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[n.jsx("span",{children:"Freq Count"}),n.jsx("span",{className:"text-purple-400",children:z.freqLength})]}),n.jsx("input",{type:"range",min:"5",max:"1024",step:"1",value:z.freqLength,onChange:e=>X("freqLength",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),n.jsxs("button",{onClick:be,className:"w-full mt-2 px-3 py-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer flex items-center justify-center gap-2",title:"Reset to defaults",children:[n.jsx(De,{size:14}),"Reset to Defaults"]})]})});return n.jsx("div",{ref:c,className:`select-none ${h?"relative mx-auto":"fixed cursor-move"}`,style:h?{zIndex:1,width:l.width,height:l.height,maxWidth:"100%"}:{left:u.x,top:u.y,width:l.width,height:l.height,zIndex:9999},onMouseDown:h?void 0:ye,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),children:n.jsxs("div",{className:`relative w-full h-full rounded-2xl overflow-hidden transition-all duration-300 ${h&&!v&&!T?"":"backdrop-blur-md"}`,style:{background:h&&!v&&!T?"transparent":"linear-gradient(135deg, rgba(15, 15, 30, 0.85), rgba(30, 20, 50, 0.85))",border:h&&!v&&!T?"1px solid transparent":"1px solid rgba(168, 85, 247, 0.3)",boxShadow:h&&!v&&!T?"none":"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(168, 85, 247, 0.1)"},children:[n.jsxs("div",{className:`absolute top-0 left-0 right-0 flex items-center justify-between px-3 py-2 z-10 transition-opacity duration-300 ${h&&!v&&!T?"opacity-0":""}`,style:{background:"linear-gradient(180deg, rgba(0,0,0,0.4), transparent)",opacity:h?v||T?1:0:T||v?1:.4},children:[n.jsx("span",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Visualizer"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:me,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${U?"text-green-400 bg-green-500/20 hover:bg-green-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:U?"Stop audio capture":"Capture tab audio",children:n.jsx(je,{size:14})}),g&&n.jsx("button",{onClick:we,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${Z?"text-purple-400 bg-purple-500/20 hover:bg-purple-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:Z?"Close PiP":"Open in PiP",children:n.jsx(Se,{size:14})}),n.jsx("button",{onClick:xe,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${T?"text-amber-400 bg-amber-500/20 hover:bg-amber-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:"Audio analyzer settings",children:n.jsx(Ce,{size:14})}),n.jsx("select",{value:s,onChange:Y,onMouseDown:e=>e.stopPropagation(),className:"px-2 py-1 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer border-none focus:outline-none",children:qe.map(e=>n.jsx("option",{value:e,className:"bg-gray-900 text-white",children:Ee[e]},e))}),m&&n.jsx("button",{onClick:e=>{e.stopPropagation(),m(a==="center"?"window":"center")},className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${a==="center"?"text-cyan-400 bg-cyan-500/20 hover:bg-cyan-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:a==="center"?"Switch to window mode":"Switch to center mode",children:a==="center"?n.jsx(ze,{size:14}):n.jsx(Me,{size:14})}),n.jsx("button",{onClick:Q,className:"p-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-red-500/30 hover:text-red-400 rounded-md transition-colors cursor-pointer",title:"Close visualizer",children:n.jsx(Ne,{size:14})})]})]}),T&&ve(),n.jsx("canvas",{ref:r,width:l.width,height:l.height,className:"w-full h-full"}),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"resize-handle absolute top-0 left-0 w-4 h-4 cursor-nw-resize",onMouseDown:e=>A(e,"nw")}),n.jsx("div",{className:"resize-handle absolute top-0 right-0 w-4 h-4 cursor-ne-resize",onMouseDown:e=>A(e,"ne")}),n.jsx("div",{className:"resize-handle absolute bottom-0 left-0 w-4 h-4 cursor-sw-resize",onMouseDown:e=>A(e,"sw")}),n.jsx("div",{className:"resize-handle absolute bottom-0 right-0 w-4 h-4 cursor-se-resize",onMouseDown:e=>A(e,"se")}),n.jsx("div",{className:"resize-handle absolute top-0 left-4 right-4 h-2 cursor-n-resize",onMouseDown:e=>A(e,"n")}),n.jsx("div",{className:"resize-handle absolute bottom-0 left-4 right-4 h-2 cursor-s-resize",onMouseDown:e=>A(e,"s")}),n.jsx("div",{className:"resize-handle absolute left-0 top-4 bottom-4 w-2 cursor-w-resize",onMouseDown:e=>A(e,"w")}),n.jsx("div",{className:"resize-handle absolute right-0 top-4 bottom-4 w-2 cursor-e-resize",onMouseDown:e=>A(e,"e")})]})]})})}export{We as default};
