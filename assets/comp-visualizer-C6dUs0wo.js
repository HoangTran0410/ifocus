import{r as o,j as t,s as ye,t as ve,u as je,v as Ce,w as ze,X as Me,T as Ne,U as Se,R as Re}from"./vendor-fot2g0I_.js";import{u as U}from"./comp-audiocontroller-CYS9XcwS.js";import{f as Pe,g as De,z as se,A as Fe,B as Q,C as Ie,D as ke,E as Te,F as Ee}from"./comp-background-CmMYPKJk.js";const ne=(s,i,p,v)=>{const h=i.width/v,c=s.createLinearGradient(0,i.height,0,0);c.addColorStop(0,"rgba(99, 102, 241, 0.8)"),c.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),c.addColorStop(1,"rgba(236, 72, 153, 0.8)"),s.fillStyle=c;for(let u=0;u<v;u++){const n=p[u]*i.height*.9,a=u*h,m=i.height-n;s.beginPath(),s.roundRect(a+1,m,h-2,n,[4,4,0,0]),s.fill()}},re=(s,i,p,v)=>{const h=i.width/(v-1),c=i.height/2,u=s.createLinearGradient(0,0,i.width,0);u.addColorStop(0,"rgba(99, 102, 241, 0.6)"),u.addColorStop(.5,"rgba(168, 85, 247, 0.6)"),u.addColorStop(1,"rgba(236, 72, 153, 0.6)"),s.fillStyle=u,s.beginPath(),s.moveTo(0,c);for(let n=0;n<v;n++){const a=n*h,m=p[n]*i.height*.4,d=c-m;if(n===0)s.lineTo(a,d);else{const S=(n-1)*h,l=(S+a)/2;s.quadraticCurveTo(S,c-p[n-1]*i.height*.4,l,(c-p[n-1]*i.height*.4+d)/2),s.quadraticCurveTo(l,d,a,d)}}for(let n=v-1;n>=0;n--){const a=n*h,m=p[n]*i.height*.4,d=c+m;if(n===v-1)s.lineTo(a,d);else{const S=(n+1)*h,l=(S+a)/2;s.quadraticCurveTo(S,c+p[n+1]*i.height*.4,l,(c+p[n+1]*i.height*.4+d)/2),s.quadraticCurveTo(l,d,a,d)}}s.closePath(),s.fill(),s.strokeStyle="rgba(255, 255, 255, 0.8)",s.lineWidth=2,s.beginPath(),s.moveTo(0,c);for(let n=0;n<v;n++){const a=n*h,m=p[n]*i.height*.4,d=c-m;s.lineTo(a,d)}s.stroke()},oe=(s,i,p,v)=>{const h=i.width/2,c=i.height/2,u=Math.min(h,c)*.4,n=Math.min(h,c)*.5,a=s.createRadialGradient(h,c,u,h,c,u+n);a.addColorStop(0,"rgba(99, 102, 241, 0.8)"),a.addColorStop(.5,"rgba(168, 85, 247, 0.8)"),a.addColorStop(1,"rgba(236, 72, 153, 0.8)"),s.fillStyle=a,s.strokeStyle="rgba(255, 255, 255, 0.3)",s.lineWidth=1;for(let m=0;m<v;m++){const d=m/v*Math.PI*2-Math.PI/2,S=p[m]*n,l=h+Math.cos(d)*u,E=c+Math.sin(d)*u,L=h+Math.cos(d)*(u+S),X=c+Math.sin(d)*(u+S);s.beginPath(),s.moveTo(l,E),s.lineTo(L,X),s.lineWidth=4,s.strokeStyle=a,s.stroke()}s.beginPath(),s.arc(h,c,u*.6,0,Math.PI*2),s.fillStyle="rgba(15, 15, 25, 0.8)",s.fill(),s.strokeStyle="rgba(168, 85, 247, 0.5)",s.lineWidth=2,s.stroke()},Z=[{exponent:1,color:"#FFFFFF",smoothMargin:0,delay:0,blurRadius:5},{exponent:1.12,color:"#FFFF00",smoothMargin:2,delay:1,blurRadius:5},{exponent:1.14,color:"#FF0000",smoothMargin:2,delay:2,blurRadius:5},{exponent:1.3,color:"#FF66FF",smoothMargin:3,delay:3,blurRadius:5},{exponent:1.33,color:"#333399",smoothMargin:3,delay:4,blurRadius:5},{exponent:1.36,color:"#0000FF",smoothMargin:3,delay:5,blurRadius:5},{exponent:1.5,color:"#33CCFF",smoothMargin:5,delay:6,blurRadius:5},{exponent:1.52,color:"#00FF00",smoothMargin:5,delay:7,blurRadius:5}],ie=(s,i,p,v,h,c)=>{const u=i.width/2,n=i.height/2,a=Math.min(i.width,i.height)/4,m=a/5,d=Math.PI/2;h.length>=Z.length&&h.shift(),h.push([...p]);const l=p.reduce((f,C)=>f+C,0)/p.length,E=1.2,X=Math.min(1,Math.max(.3,1/(E-1)*(-Math.pow(l,E)+E*l)))*(a-m)+m;for(let f=Z.length-1;f>=0;f--){const C=Z[f],F=Math.max(h.length-C.delay-1,0),x=h[F]||p,b=[],A=x.length;for(let R=0;R<A;R++){const N=Math.PI*(R/(A-1))-d,P=X+Math.pow(x[R]*a*.3,C.exponent),j=P*Math.cos(N),W=P*Math.sin(N);b.push({x:j,y:W})}s.fillStyle=C.color,s.shadowColor=C.color,s.shadowBlur=C.blurRadius,s.beginPath();for(let R=0;R<=1;R++){const N=R?-1:1;s.moveTo(u,b[0].y+n);for(let j=1;j<b.length-2;j++){const W=N*(b[j].x+b[j+1].x)/2+u,O=(b[j].y+b[j+1].y)/2+n;s.quadraticCurveTo(N*b[j].x+u,b[j].y+n,W,O)}const P=b.length-1;s.quadraticCurveTo(N*b[P-1].x+u+R*2,b[P-1].y+n,N*b[P].x+u,b[P].y+n)}s.fill()}if(s.shadowBlur=0,c){const f=X*2,C=f/2;s.save(),s.beginPath(),s.arc(u,n,C,0,Math.PI*2),s.closePath(),s.clip();const F=u-C,x=n-C;s.drawImage(c,F,x,f,f),s.restore()}},Le=["bars","wave","circular","trap-nation"],Xe={bars:"Bars",wave:"Wave",circular:"Circular","trap-nation":"Trap Nation"},ae=120,le=120,ce=400,ue=200;function Ye({onClose:s,isCenterMode:i=!1,allowPiP:p=!0}){const v=Pe(),h=De(),c=o.useRef(null),u=o.useRef(null),n=o.useRef(0),[a,m]=U("zen_visualizer_mode","bars"),[d,S]=U("zen_visualizer_position",{x:50,y:50}),[l,E]=U("zen_visualizer_size",{width:ce,height:ue}),[L,X]=o.useState(!1),[f,C]=o.useState(null),F=o.useRef({x:0,y:0,posX:0,posY:0}),x=o.useRef({x:0,y:0,width:ce,height:ue,posX:0,posY:0}),b=o.useRef(new Array(64).fill(0)),A=o.useRef(0),R=o.useRef([]),[N,P]=U("zen_visualizer_logo",null),j=o.useRef(null);o.useEffect(()=>{if(N){const e=new Image;e.onload=()=>{j.current=e},e.src=N}else j.current=null},[N]);const W=o.useCallback(e=>{var g;const r=(g=e.target.files)==null?void 0:g[0];if(r){const w=new FileReader;w.onload=M=>{var H;const y=(H=M.target)==null?void 0:H.result;P(y)},w.readAsDataURL(r)}},[P]),O=o.useCallback(()=>{P(null)},[P]),[_,ee]=o.useState(!1),de=o.useCallback(e=>{e.stopPropagation(),m(e.target.value)},[m]),he=o.useCallback(e=>{e.stopPropagation(),s==null||s()},[s]),[B,te]=o.useState(()=>se()),ge=o.useCallback(async e=>{if(e.stopPropagation(),B)Ee(),te(!1);else{const r=await Fe();te(r)}},[B]),[V,$]=o.useState(!1),I=o.useRef(null),D=o.useRef(null),[k,pe]=o.useState(!1),[z,G]=U("zen_visualizer_config",ke());o.useEffect(()=>{Q(z)},[]);const Y=o.useCallback((e,r)=>{const g={...z,[e]:r};G(g),Q({[e]:r})},[z,G]),me=o.useCallback(e=>{e.stopPropagation(),pe(r=>!r)},[]),fe=o.useCallback(e=>{e.stopPropagation();const r=Ie();G(r),Q(r)},[G]),xe=o.useCallback(async e=>{if(e.stopPropagation(),!window.documentPictureInPicture){alert("Document Picture-in-Picture is not supported in your browser. Please use Chrome 116+ or Edge 116+.");return}if(I.current&&!I.current.closed){I.current.close(),I.current=null,D.current=null,$(!1);return}try{const r=await window.documentPictureInPicture.requestWindow({width:l.width,height:l.height});I.current=r,r.document.body.style.margin="0",r.document.body.style.padding="0",r.document.body.style.overflow="hidden",r.document.body.style.background="linear-gradient(135deg, rgba(15, 15, 30, 1), rgba(30, 20, 50, 1))";const g=r.document.createElement("canvas");g.width=l.width,g.height=l.height,g.style.width="100%",g.style.height="100%",r.document.body.appendChild(g),D.current=g,r.addEventListener("pagehide",()=>{I.current=null,D.current=null,$(!1)}),$(!0)}catch(r){console.error("PiP error:",r),alert("Failed to activate Picture-in-Picture mode. Error: "+r.message),$(!1)}},[l]);o.useEffect(()=>()=>{I.current&&!I.current.closed&&I.current.close()},[]);const be=o.useCallback(e=>{e.target.classList.contains("resize-handle")||(e.preventDefault(),X(!0),F.current={x:e.clientX,y:e.clientY,posX:d.x,posY:d.y})},[d]),J=o.useCallback(e=>{if(L){const r=e.clientX-F.current.x,g=e.clientY-F.current.y;S({x:F.current.posX+r,y:F.current.posY+g})}else if(f){const r=e.clientX-x.current.x,g=e.clientY-x.current.y;let w=x.current.width,M=x.current.height,y=x.current.posX,H=x.current.posY;if(f.includes("e")&&(w=Math.max(ae,x.current.width+r)),f.includes("w")){const q=x.current.width-r;q>=ae&&(w=q,y=x.current.posX+r)}if(f.includes("s")&&(M=Math.max(le,x.current.height+g)),f.includes("n")){const q=x.current.height-g;q>=le&&(M=q,H=x.current.posY+g)}E({width:w,height:M}),S({x:y,y:H})}},[L,f,l.width,l.height]),K=o.useCallback(()=>{X(!1),C(null)},[]);o.useEffect(()=>{if(L||f)return window.addEventListener("mousemove",J),window.addEventListener("mouseup",K),()=>{window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",K)}},[L,f,J,K]);const T=o.useCallback((e,r)=>{e.preventDefault(),e.stopPropagation(),C(r),x.current={x:e.clientX,y:e.clientY,width:l.width,height:l.height,posX:d.x,posY:d.y}},[l,d]);o.useEffect(()=>{const e=c.current;if(!e)return;const r=e.getContext("2d");if(!r)return;const g=()=>{A.current+=.02;let w;if(se())w=Te();else{for(let y=0;y<b.current.length;y++){const q=.3+(Math.sin(A.current*2+y*.3)*.3+Math.sin(A.current*3.5+y*.5)*.2+Math.sin(A.current*1.2+y*.7)*.25)*.5;b.current[y]=Math.max(0,Math.min(1,q+Math.random()*.1))}w=b.current}r.clearRect(0,0,e.width,e.height);const M=w.length;if(a==="bars"?ne(r,e,w,M):a==="wave"?re(r,e,w,M):a==="circular"?oe(r,e,w,M):a==="trap-nation"&&ie(r,e,w,M,R.current,j.current),D.current){const y=D.current.getContext("2d");y&&(y.clearRect(0,0,D.current.width,D.current.height),a==="bars"?ne(y,D.current,w,M):a==="wave"?re(y,D.current,w,M):a==="circular"?oe(y,D.current,w,M):a==="trap-nation"&&ie(y,D.current,w,M,R.current,j.current))}n.current=requestAnimationFrame(g)};return g(),()=>{cancelAnimationFrame(n.current)}},[a,l,V]);const we=()=>t.jsx("div",{className:"absolute top-10 left-0 right-0 z-20 p-3 mx-2 rounded-lg",style:{background:"rgba(15, 15, 30, 0.45)",border:"1px solid rgba(168, 85, 247, 0.3)",maxHeight:l.height-50,overflowY:"auto"},onMouseDown:e=>e.stopPropagation(),children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:t.jsx("span",{children:"FFT Size"})}),t.jsx("select",{value:z.fftSize,onChange:e=>Y("fftSize",parseInt(e.target.value)),className:"w-full px-2 py-1 text-xs bg-white/10 text-white/90 rounded-md border border-white/20 cursor-pointer focus:outline-none focus:border-purple-500",children:[32,64,128,256,512,1024,2048,4096,8192,16384,32768].map(e=>t.jsx("option",{value:e,className:"bg-gray-900",children:e},e))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[t.jsx("span",{children:"Smoothing"}),t.jsx("span",{className:"text-purple-400",children:z.smoothingTimeConstant.toFixed(2)})]}),t.jsx("input",{type:"range",min:"0",max:"0.99",step:"0.01",value:z.smoothingTimeConstant,onChange:e=>Y("smoothingTimeConstant",parseFloat(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[t.jsx("span",{children:"Min dB"}),t.jsx("span",{className:"text-purple-400",children:z.minDecibels})]}),t.jsx("input",{type:"range",min:"-100",max:"-30",step:"1",value:z.minDecibels,onChange:e=>Y("minDecibels",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[t.jsx("span",{children:"Max dB"}),t.jsx("span",{className:"text-purple-400",children:z.maxDecibels})]}),t.jsx("input",{type:"range",min:"-50",max:"0",step:"1",value:z.maxDecibels,onChange:e=>Y("maxDecibels",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[t.jsx("span",{children:"Freq Start"}),t.jsx("span",{className:"text-purple-400",children:z.freqStartIndex})]}),t.jsx("input",{type:"range",min:"0",max:"1024",step:"1",value:z.freqStartIndex,onChange:e=>Y("freqStartIndex",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[t.jsx("span",{children:"Freq Count"}),t.jsx("span",{className:"text-purple-400",children:z.freqLength})]}),t.jsx("input",{type:"range",min:"5",max:"1024",step:"1",value:z.freqLength,onChange:e=>Y("freqLength",parseInt(e.target.value)),className:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),t.jsxs("div",{className:"pt-2 border-t border-white/10",children:[t.jsx("label",{className:"flex justify-between text-xs text-white/70 mb-2",children:t.jsx("span",{children:"Center Logo (Trap Nation)"})}),N?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:N,alt:"Logo preview",className:"w-12 h-12 object-contain rounded bg-white/10"}),t.jsxs("button",{onClick:O,className:"flex-1 px-3 py-1.5 text-xs font-medium text-red-400 bg-red-500/10 hover:bg-red-500/20 rounded-md transition-colors cursor-pointer flex items-center justify-center gap-2",children:[t.jsx(Ne,{size:14}),"Remove"]})]}):t.jsxs("label",{className:"w-full px-3 py-2 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer flex items-center justify-center gap-2",children:[t.jsx(Se,{size:14}),"Upload Image",t.jsx("input",{type:"file",accept:"image/*",onChange:W,className:"hidden"})]})]}),t.jsxs("button",{onClick:fe,className:"w-full mt-2 px-3 py-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer flex items-center justify-center gap-2",title:"Reset to defaults",children:[t.jsx(Re,{size:14}),"Reset to Defaults"]})]})});return t.jsx("div",{ref:u,className:`select-none ${i?"relative":"fixed cursor-move"}`,style:i?{zIndex:1,width:l.width,height:l.height,left:"50%",transform:"translateX(-50%)"}:{left:d.x,top:d.y,width:l.width,height:l.height,zIndex:9999},onMouseDown:i?void 0:be,onMouseEnter:()=>ee(!0),onMouseLeave:()=>ee(!1),children:t.jsxs("div",{className:`relative w-full h-full rounded-2xl overflow-hidden transition-all duration-300 ${i&&!_&&!k?"":"backdrop-blur-md"}`,style:{background:i&&!_&&!k?"transparent":"linear-gradient(135deg, rgba(15, 15, 30, 0.85), rgba(30, 20, 50, 0.85))",border:i&&!_&&!k?"1px solid transparent":"1px solid rgba(168, 85, 247, 0.3)",boxShadow:i&&!_&&!k?"none":"0 8px 32px rgba(0, 0, 0, 0.4), 0 0 60px rgba(168, 85, 247, 0.1)"},children:[t.jsxs("div",{className:`absolute top-0 left-0 right-0 flex items-center justify-between px-3 py-2 z-10 transition-opacity duration-300 ${i&&!_&&!k?"opacity-0":""}`,style:{background:"linear-gradient(180deg, rgba(0,0,0,0.4), transparent)",opacity:i?_||k?1:0:k||_?1:.4},children:[t.jsx("span",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Visualizer"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:ge,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${B?"text-green-400 bg-green-500/20 hover:bg-green-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:B?"Stop audio capture":"Capture tab audio",children:t.jsx(ye,{size:14})}),p&&t.jsx("button",{onClick:xe,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${V?"text-purple-400 bg-purple-500/20 hover:bg-purple-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:V?"Close PiP":"Open in PiP",children:t.jsx(ve,{size:14})}),t.jsx("button",{onClick:me,className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${k?"text-amber-400 bg-amber-500/20 hover:bg-amber-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:"Audio analyzer settings",children:t.jsx(je,{size:14})}),t.jsx("select",{value:a,onChange:de,onMouseDown:e=>e.stopPropagation(),className:"px-2 py-1 text-xs font-medium text-white/80 bg-white/10 hover:bg-white/20 rounded-md transition-colors cursor-pointer border-none focus:outline-none",children:Le.map(e=>t.jsx("option",{value:e,className:"bg-gray-900 text-white",children:Xe[e]},e))}),h&&t.jsx("button",{onClick:e=>{e.stopPropagation(),h(v==="center"?"window":"center")},className:`p-1.5 text-xs font-medium rounded-md transition-colors cursor-pointer ${v==="center"?"text-cyan-400 bg-cyan-500/20 hover:bg-cyan-500/30":"text-white/80 bg-white/10 hover:bg-white/20"}`,title:v==="center"?"Switch to window mode":"Switch to center mode",children:v==="center"?t.jsx(Ce,{size:14}):t.jsx(ze,{size:14})}),t.jsx("button",{onClick:he,className:"p-1.5 text-xs font-medium text-white/80 bg-white/10 hover:bg-red-500/30 hover:text-red-400 rounded-md transition-colors cursor-pointer",title:"Close visualizer",children:t.jsx(Me,{size:14})})]})]}),k&&we(),t.jsx("canvas",{ref:c,width:l.width,height:l.height,className:"w-full h-full"}),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"resize-handle absolute top-0 left-0 w-4 h-4 cursor-nw-resize",onMouseDown:e=>T(e,"nw")}),t.jsx("div",{className:"resize-handle absolute top-0 right-0 w-4 h-4 cursor-ne-resize",onMouseDown:e=>T(e,"ne")}),t.jsx("div",{className:"resize-handle absolute bottom-0 left-0 w-4 h-4 cursor-sw-resize",onMouseDown:e=>T(e,"sw")}),t.jsx("div",{className:"resize-handle absolute bottom-0 right-0 w-4 h-4 cursor-se-resize",onMouseDown:e=>T(e,"se")}),t.jsx("div",{className:"resize-handle absolute top-0 left-4 right-4 h-2 cursor-n-resize",onMouseDown:e=>T(e,"n")}),t.jsx("div",{className:"resize-handle absolute bottom-0 left-4 right-4 h-2 cursor-s-resize",onMouseDown:e=>T(e,"s")}),t.jsx("div",{className:"resize-handle absolute left-0 top-4 bottom-4 w-2 cursor-w-resize",onMouseDown:e=>T(e,"w")}),t.jsx("div",{className:"resize-handle absolute right-0 top-4 bottom-4 w-2 cursor-e-resize",onMouseDown:e=>T(e,"e")})]})]})})}export{Ye as default};
