const a={stars:[],initialized:!1,shockwaves:[],lastBeatTime:0,rotation:0,coronaExplosion:null};function B({ctx:l,canvas:e,data:S,performanceMode:C=!1,beatIntensity:h=0}){const r=e.width/2,t=e.height/2,P=S.reduce((o,i)=>o+i,0)/S.length,b=C?50:100,k=Date.now();if(!a.initialized||a.stars.length!==b){a.stars=[];for(let o=0;o<b;o++)a.stars.push({x:(Math.random()-.5)*e.width*2,y:(Math.random()-.5)*e.height*2,z:Math.random()*e.width,prevX:0,prevY:0});a.initialized=!0}h>.6&&k-a.lastBeatTime>400&&(a.lastBeatTime=k,a.shockwaves.push({radius:10,alpha:.5,hue:200+Math.random()*100}));const m=1+S.slice(0,Math.floor(S.length/4)).reduce((o,i)=>o+i,0)/(S.length/4)*4+h*6,F=h>.5;if(a.stars.forEach((o,i)=>{const u=o.z;o.prevX=o.x/u*e.width+r,o.prevY=o.y/u*e.height+t,o.z-=m,o.z<=0&&(o.x=(Math.random()-.5)*e.width*2,o.y=(Math.random()-.5)*e.height*2,o.z=e.width,o.prevX=o.x/o.z*e.width+r,o.prevY=o.y/o.z*e.height+t);const s=o.x/o.z*e.width+r,p=o.y/o.z*e.height+t;if(s<0||s>e.width||p<0||p>e.height)return;const f=Math.max(.5,(e.width-o.z)/e.width*3)*(1+h*.5),n=.5+(e.width-o.z)/e.width,w=i%S.length,y=S[w];let $=200+w/S.length*60;F&&($=40+w/S.length*40);const R=h>.3?.1:.3;if(!C&&n>R&&(l.beginPath(),l.moveTo(o.prevX,o.prevY),l.lineTo(s,p),l.strokeStyle=`hsla(${$}, 80%, ${60+y*30}%, ${n*(.5+h*.3)})`,l.lineWidth=f*(.5+h*.5),l.stroke()),l.beginPath(),l.arc(s,p,f,0,Math.PI*2),!C&&(n>.5||h>.4)){const T=f*(2+h*2),M=l.createRadialGradient(s,p,0,s,p,T);M.addColorStop(0,`hsla(${$}, 90%, 95%, 1)`),M.addColorStop(.3,`hsla(${$}, 80%, 80%, ${n+h*.3})`),M.addColorStop(1,"transparent"),l.fillStyle=M,l.arc(s,p,T,0,Math.PI*2)}else l.fillStyle=`hsla(${$}, 70%, ${70+n*30}%, ${n})`;l.fill()}),C||(a.shockwaves=a.shockwaves.filter(o=>(o.radius+=4+P*3,o.alpha-=.012,o.alpha<=0?!1:(l.beginPath(),l.arc(r,t,o.radius,0,Math.PI*2),l.strokeStyle=`hsla(${o.hue}, 80%, 70%, ${o.alpha})`,l.lineWidth=2+o.alpha*3,l.stroke(),l.beginPath(),l.arc(r,t,o.radius*.9,0,Math.PI*2),l.strokeStyle=`hsla(${o.hue+30}, 90%, 80%, ${o.alpha*.5})`,l.lineWidth=1,l.stroke(),!0)))),!C&&h>.5){const o=30+h*80,i=l.createRadialGradient(r,t,0,r,t,o);i.addColorStop(0,`rgba(255, 255, 255, ${h*.3})`),i.addColorStop(.3,`rgba(255, 200, 100, ${h*.15})`),i.addColorStop(1,"transparent"),l.fillStyle=i,l.beginPath(),l.arc(r,t,o,0,Math.PI*2),l.fill()}a.rotation+=.003+P*.08;const d=25+P*15+h*15;if(h>.5&&(!a.coronaExplosion||a.coronaExplosion.alpha<.3)&&(a.coronaExplosion={size:d*1.2,alpha:1,maxSize:d*5}),a.coronaExplosion){const o=a.coronaExplosion;if(o.size+=(o.maxSize-o.size)*.03,o.alpha-=.008,o.alpha>0){const i=l.createRadialGradient(r,t,d*.8,r,t,o.size);if(i.addColorStop(0,`rgba(255, 100, 50, ${o.alpha*.7})`),i.addColorStop(.3,`rgba(255, 50, 0, ${o.alpha*.5})`),i.addColorStop(.6,`rgba(200, 0, 0, ${o.alpha*.3})`),i.addColorStop(1,"transparent"),l.fillStyle=i,l.beginPath(),l.arc(r,t,o.size,0,Math.PI*2),l.fill(),!C&&o.alpha>.4)for(let s=0;s<8;s++){const p=s/8*Math.PI*2+a.rotation,g=o.size*.8,f=d*.4;l.save(),l.translate(r,t),l.rotate(p);const n=l.createLinearGradient(d,0,g,0);n.addColorStop(0,`rgba(255, 150, 50, ${o.alpha*.6})`),n.addColorStop(.5,`rgba(255, 80, 0, ${o.alpha*.4})`),n.addColorStop(1,"transparent"),l.fillStyle=n,l.beginPath(),l.moveTo(d*.8,0),l.lineTo(g,-f*.2),l.lineTo(g,f*.2),l.closePath(),l.fill(),l.restore()}}else a.coronaExplosion=null}const E=d*1.8,G=l.createRadialGradient(r,t,d*.5,r,t,E);G.addColorStop(0,`rgba(255, 120, 50, ${.6+P*.3})`),G.addColorStop(.5,`rgba(255, 60, 20, ${.3+P*.2})`),G.addColorStop(1,"transparent"),l.fillStyle=G,l.beginPath(),l.arc(r,t,E,0,Math.PI*2),l.fill();const z=l.createRadialGradient(r-d*.2,t-d*.2,0,r,t,d);if(z.addColorStop(0,"#FFF5E0"),z.addColorStop(.2,"#FFCC66"),z.addColorStop(.4,"#FF8844"),z.addColorStop(.7,"#DD4422"),z.addColorStop(1,"#AA2200"),l.fillStyle=z,l.beginPath(),l.arc(r,t,d,0,Math.PI*2),l.fill(),!C)for(let i=0;i<3;i++){const u=i/3*Math.PI*2+a.rotation*.5,s=d*.4,p=r+Math.cos(u)*s,g=t+Math.sin(u)*s,f=d*(.12+i%2*.08),n=l.createRadialGradient(p,g,0,p,g,f);n.addColorStop(0,"rgba(80, 20, 5, 0.5)"),n.addColorStop(1,"transparent"),l.fillStyle=n,l.beginPath(),l.arc(p,g,f,0,Math.PI*2),l.fill()}}export{B as default};
