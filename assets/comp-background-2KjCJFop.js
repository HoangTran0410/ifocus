const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./comp-effectslayer-Bu46EjfV.js","./vendor-7n6RyNsU.js"])))=>i.map(i=>d[i]);
import{c as ge,p as he,j as n,L as ye,r as v,a as X,l as te}from"./vendor-7n6RyNsU.js";import{D as se,a as ne,b as be}from"./comp-audiocontroller-C9_egn6F.js";const pe="modulepreload",we=function(e,o){return new URL(e,o).href},ee={},re=function(o,t,r){let i=Promise.resolve();if(t&&t.length>0){let h=function(l){return Promise.all(l.map(S=>Promise.resolve(S).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};const g=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),x=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));i=h(t.map(l=>{if(l=we(l,r),l in ee)return;ee[l]=!0;const S=l.endsWith(".css"),C=S?'[rel="stylesheet"]':"";if(!!r)for(let m=g.length-1;m>=0;m--){const z=g[m];if(z.href===l&&(!S||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${C}`))return;const M=document.createElement("link");if(M.rel=S?"stylesheet":pe,S||(M.as="script"),M.crossOrigin="",M.href=l,x&&M.setAttribute("nonce",x),document.head.appendChild(M),S)return new Promise((m,z)=>{M.addEventListener("load",m),M.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${l}`)))})}))}function d(h){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=h,window.dispatchEvent(g),!g.defaultPrevented)throw h}return i.then(h=>{for(const g of h||[])g.status==="rejected"&&d(g.reason);return o().catch(d)})},u=ge()(he((e,o)=>({currentScene:be[0],setCurrentScene:t=>e({currentScene:t}),currentEffect:"none",setCurrentEffect:t=>e({currentEffect:t}),timerMode:"pomodoro",showTimer:!0,setTimerMode:t=>e({timerMode:t}),setShowTimer:t=>e({showTimer:t}),showVisualizer:!1,visualizerMode:"window",setShowVisualizer:t=>e({showVisualizer:t}),setVisualizerMode:t=>e({visualizerMode:t}),isBgMuted:!0,bgFilters:ne,bgInitialZoom:100,syncVisualizerConfig:se,showVideoModal:!1,setIsBgMuted:t=>e({isBgMuted:t}),setBgFilters:t=>e({bgFilters:t}),setBgInitialZoom:t=>e({bgInitialZoom:t}),setSyncVisualizerConfig:t=>e({syncVisualizerConfig:t}),setShowVideoModal:t=>e({showVideoModal:t}),tasks:[],setTasks:t=>e(r=>({tasks:typeof t=="function"?t(r.tasks):t})),addTask:t=>e(r=>({tasks:[...r.tasks,t]})),toggleTask:t=>e(r=>({tasks:r.tasks.map(i=>i.id===t?{...i,completed:!i.completed}:i)})),deleteTask:t=>e(r=>({tasks:r.tasks.filter(i=>i.id!==t)})),notes:[],setNotes:t=>e(r=>({notes:typeof t=="function"?t(r.notes):t})),addNote:t=>e(r=>({notes:[t,...r.notes]})),updateNote:(t,r)=>e(i=>({notes:i.notes.map(d=>d.id===t?{...d,...r,updatedAt:Date.now()}:d)})),deleteNote:t=>e(r=>({notes:r.notes.filter(i=>i.id!==t)}))}),{name:"ifocus-storage",partialize:e=>({currentScene:e.currentScene,currentEffect:e.currentEffect,timerMode:e.timerMode,showTimer:e.showTimer,showVisualizer:e.showVisualizer,visualizerMode:e.visualizerMode,isBgMuted:e.isBgMuted,bgFilters:e.bgFilters,bgInitialZoom:e.bgInitialZoom,syncVisualizerConfig:e.syncVisualizerConfig,tasks:e.tasks,notes:e.notes})})),Se=()=>u(e=>e.currentScene),Re=()=>u(e=>e.setCurrentScene),ve=()=>u(e=>e.currentEffect),Le=()=>u(e=>e.setCurrentEffect),Pe=()=>u(e=>e.timerMode),$e=()=>u(e=>e.setTimerMode),qe=()=>u(e=>e.showTimer),Ue=()=>u(e=>e.setShowTimer),Ze=()=>u(e=>e.showVisualizer),Oe=()=>u(e=>e.setShowVisualizer),He=()=>u(e=>e.visualizerMode),Ge=()=>u(e=>e.setVisualizerMode),xe=()=>u(e=>e.isBgMuted),Ye=()=>u(e=>e.setIsBgMuted),Me=()=>u(e=>e.bgFilters),We=()=>u(e=>e.setBgFilters),Ce=()=>u(e=>e.bgInitialZoom),Je=()=>u(e=>e.setBgInitialZoom),Ee=()=>u(e=>e.syncVisualizerConfig),Ke=()=>u(e=>e.setSyncVisualizerConfig),ke=()=>u(e=>e.showVideoModal),ze=()=>u(e=>e.setShowVideoModal),Qe=()=>u(e=>e.tasks),Xe=()=>u(e=>e.setTasks),et=()=>u(e=>e.notes),tt=()=>u(e=>e.setNotes),ae=n.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:n.jsx(ye,{className:"w-6 h-6 text-white/50 animate-spin"})});let w=null,c=null,p=null,I=null,b=null,k=null,V=!1,N="none";const oe={fftSize:8192,smoothingTimeConstant:.03,minDecibels:-85,maxDecibels:-22,freqStartIndex:4,freqLength:25},F={...oe};function st(){return{...oe}}function nt(){return{...F}}function rt(e){Object.assign(F,e),c&&(e.fftSize!==void 0&&(c.fftSize=e.fftSize,p=new Uint8Array(c.frequencyBinCount)),e.smoothingTimeConstant!==void 0&&(c.smoothingTimeConstant=e.smoothingTimeConstant),e.minDecibels!==void 0&&(c.minDecibels=e.minDecibels),e.maxDecibels!==void 0&&(c.maxDecibels=e.maxDecibels))}function at(){return N}function O(){w||(w=new AudioContext),c||(c=w.createAnalyser(),c.fftSize=F.fftSize,c.smoothingTimeConstant=F.smoothingTimeConstant,c.minDecibels=F.minDecibels,c.maxDecibels=F.maxDecibels,p=new Uint8Array(c.frequencyBinCount))}async function ot(){if(V&&N==="tab")return!0;j();try{I=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser"},audio:{suppressLocalAudioPlayback:!1},selfBrowserSurface:"include",systemAudio:"include",surfaceSwitching:"include",monitorTypeSurfaces:"include"});const e=I.getAudioTracks();return e.length===0?(console.warn("No audio track in the captured stream"),j(),!1):(O(),k=w.createMediaStreamSource(I),k.connect(c),e[0].addEventListener("ended",()=>{j()}),V=!0,N="tab",!0)}catch(e){return console.error("Failed to start tab audio capture:",e),j(),!1}}async function it(){if(V&&N==="mic")return!0;if(j(),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){const e="Microphone access requires HTTPS. Please access the site via HTTPS.";return console.error(e),alert(e),!1}try{return I=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}),O(),k=w.createMediaStreamSource(I),k.connect(c),I.getAudioTracks()[0].addEventListener("ended",()=>{j()}),V=!0,N="mic",!0}catch(e){return console.error("Failed to start microphone capture:",e),alert(`Mic capture error: ${e.message||e}`),j(),!1}}async function lt(e){j();try{return b=new Audio,b.src=URL.createObjectURL(e),b.loop=!0,b.crossOrigin="anonymous",await new Promise((o,t)=>{b.oncanplaythrough=()=>o(),b.onerror=()=>t(new Error("Failed to load audio file"))}),O(),w.state==="suspended"&&await w.resume(),k=w.createMediaElementSource(b),k.connect(c),k.connect(w.destination),await b.play(),b.onended=()=>{},V=!0,N="file",!0}catch(o){return console.error("Failed to start file audio capture:",o),j(),!1}}function j(){if(I&&(I.getTracks().forEach(e=>e.stop()),I=null),b){b.pause(),b.currentTime=0;const e=b.src;e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),b.onended=null,b.oncanplaythrough=null,b.onerror=null,b.src="",b.load(),b=null}if(k){try{k.disconnect()}catch{}k=null}w&&(w.close(),w=null),c=null,p=null,V=!1,N="none"}function _e(){return!c||!p?new Uint8Array(64).fill(0):(c.getByteFrequencyData(p),p)}function Te(e,o=3,t=1){const r=Math.floor(o/2),i=1/(2*r+1);let d=e.slice(),h=[];for(let g=0;g<t;g++){for(let f=0;f<r;f++)h[f]=d[f],h[d.length-f-1]=d[d.length-f-1];for(let f=r;f<d.length-r;f++){let x=0;for(let l=-r;l<=r;l++)x+=i*d[f+l]+l;h[f]=x}d=h}return h}function ct(){const e=_e(),o=F.freqStartIndex,t=Math.min(o+F.freqLength,e.length),i=Array.from(e.slice(o,t)).map(d=>d/255);return Te(i,5,2)}function je(){return V&&c!==null}const y={energyHistory:[],historySize:43,beatThreshold:1.3,beatCooldown:0,cooldownFrames:8,lastBeatIntensity:0,beatDecay:.92};function Ie(){if(!c||!p||!w)return 0;c.getByteFrequencyData(p);const e=w.sampleRate,o=c.fftSize,t=p.length,r=Math.max(1,Math.round(20*o/e)),i=Math.min(t,Math.round(250*o/e)),d=Math.max(1,i-r);let h=0;for(let g=r;g<i&&g<t;g++)h+=p[g];return h/(d*255)}function L(e,o,t){return Math.round(e*o/t)}function ut(){if(!c||!p||!w)return{bass:0,mid:0,high:0};c.getByteFrequencyData(p);const e=w.sampleRate,o=c.fftSize,t=p.length,r=Math.max(1,L(20,o,e)),i=Math.min(t,L(250,o,e)),d=Math.min(t,L(250,o,e)),h=Math.min(t,L(2e3,o,e)),g=Math.min(t,L(2e3,o,e)),f=Math.min(t,L(16e3,o,e));let x=0;const l=Math.max(1,i-r);for(let m=r;m<i&&m<t;m++)x+=p[m];let S=0;const C=Math.max(1,h-d);for(let m=d;m<h&&m<t;m++)S+=p[m];let A=0;const M=Math.max(1,f-g);for(let m=g;m<f&&m<t;m++)A+=p[m];return{bass:x/(l*255),mid:S/(C*255),high:A/(M*255)}}function Fe(){const e=Ie();if(y.energyHistory.push(e),y.energyHistory.length>y.historySize&&y.energyHistory.shift(),y.energyHistory.length<10)return y.lastBeatIntensity*=y.beatDecay;const o=y.energyHistory.reduce((r,i)=>r+i,0)/y.energyHistory.length;if(y.beatCooldown>0&&y.beatCooldown--,y.beatCooldown===0&&e>o*y.beatThreshold&&e>.1){const r=Math.min(1,(e-o)/o);y.lastBeatIntensity=Math.max(y.lastBeatIntensity,r),y.beatCooldown=y.cooldownFrames}return y.lastBeatIntensity*=y.beatDecay,y.lastBeatIntensity}const Be=te(()=>re(()=>import("./vendor-7n6RyNsU.js").then(e=>e.Y),[],import.meta.url),{fallback:ae}),Ve=te(()=>re(()=>import("./comp-effectslayer-Bu46EjfV.js"),__vite__mapDeps([0,1]),import.meta.url),{fallback:ae});function Ne({disableYouTube:e=!1,isInPiP:o=!1}){const t=Se(),r=ve(),i=xe(),d=Me(),h=Ce(),g=Ee(),f=ke(),x=ze(),l=v.useRef(null),[S,C]=v.useState(!1),[A,M]=v.useState(!1),[m,z]=v.useState(!1),P=v.useRef(!1),_=f||m,D=v.useRef(null),R=v.useRef(null),Z=v.useRef(0),B={...se,...g},H=()=>{const s=[],a={...ne,...d};return a.blur>0&&s.push(`blur(${a.blur}px)`),a.brightness!==100&&s.push(`brightness(${a.brightness}%)`),a.contrast!==100&&s.push(`contrast(${a.contrast}%)`),a.grayscale>0&&s.push(`grayscale(${a.grayscale}%)`),a.hueRotate!==0&&s.push(`hue-rotate(${a.hueRotate}deg)`),a.invert>0&&s.push(`invert(${a.invert}%)`),a.opacity!==100&&s.push(`opacity(${a.opacity}%)`),a.saturate!==100&&s.push(`saturate(${a.saturate}%)`),a.sepia>0&&s.push(`sepia(${a.sepia}%)`),s.length>0?s.join(" "):"none"},ie=()=>h/100;v.useEffect(()=>{const s=ie();if(!B.enabled){D.current&&(D.current.style.transform=`scale(${s})`),R.current&&(R.current.style.transform=`scale(${s})`);return}let a=s;const T=()=>{const $=E=>{E&&(E.style.transform=`scale(${a})`)};if(je()){const E=Fe(),U=s+E*B.intensity;a+=(U-a)*B.speed}else a+=(s-a)*B.speed;$(D.current),$(R.current),Z.current=requestAnimationFrame(T)};return Z.current=requestAnimationFrame(T),()=>{cancelAnimationFrame(Z.current),D.current&&(D.current.style.transform=`scale(${s})`),R.current&&(R.current.style.transform=`scale(${s})`)}},[B.enabled,B.speed,B.intensity,h]);const G=()=>{x(!1),z(!1)},Y=s=>{const a=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,T=s.match(a);return T&&T[2].length===11?T[2]:null};v.useEffect(()=>{if(C(!1),x(!1),z(!1),P.current=!1,t.type==="image"){const s=new Image;s.onload=()=>C(!0),s.src=t.url}return()=>{l.current=null}},[t.url,t.type,x]),v.useEffect(()=>{if(l.current&&t.type==="youtube")try{i?l.current.mute():l.current.unMute()}catch(s){console.warn("Error changing mute state:",s)}},[i,t.type]);const W=v.useCallback(()=>{var s,a,T,$;if(!(!l.current||P.current))try{const E=(a=(s=l.current).getPlayerState)==null?void 0:a.call(s);if(E===void 0)return;E!==1&&E!==3&&(($=(T=l.current).playVideo)==null||$.call(T),setTimeout(()=>{var U,Q;if(l.current)try{const q=(Q=(U=l.current).getPlayerState)==null?void 0:Q.call(U);q!==void 0&&q!==1&&q!==3&&!P.current&&z(!0)}catch(q){console.warn("Error checking player state:",q)}},500))}catch(E){console.warn("Error checking YouTube player state:",E)}},[]);v.useEffect(()=>{if(t.type!=="youtube"||e)return;const s=()=>{W()};return window.addEventListener("click",s),()=>window.removeEventListener("click",s)},[t.type,e,W]);const le=s=>{try{l.current=s.target,i?s.target.mute():s.target.unMute(),s.target.playVideo()}catch(a){console.warn("Error in onPlayerReady:",a)}},ce=s=>{try{s.data===1&&(P.current=!0,z(!1))}catch(a){console.warn("Error in onPlayerStateChange:",a)}},ue=s=>{console.error("YouTube player error:",s.data),s.data===150||s.data===101?console.warn("Video may be unavailable or embedding restricted"):M(!0)},de={playerVars:{autoplay:1,mute:1,controls:1,loop:1,playlist:t.type==="youtube"&&Y(t.url)||"",playsinline:1,showinfo:0,rel:0,iv_load_policy:3,disablekb:1,modestbranding:1}},J=()=>n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
                @keyframes modalFadeIn {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
              `}),_&&n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm",style:{zIndex:99998,animation:"modalFadeIn 0.3s ease-out forwards"},onClick:G}),n.jsx("div",{ref:_?void 0:R,className:_?"contents":"fixed inset-0 w-full h-full overflow-hidden",style:_?void 0:{zIndex:-1,filter:H(),transformOrigin:"center center",transition:"filter 700ms ease-in-out"},children:n.jsxs("div",{className:_?"fixed w-[80vw] max-w-4xl aspect-video left-1/2 top-1/2 rounded-xl overflow-hidden shadow-2xl border border-white/10 bg-black":"w-full h-full",style:_?{zIndex:99999,transform:"translate(-50%, -50%)",animation:"modalFadeIn 0.3s ease-out forwards"}:{pointerEvents:"none"},children:[_&&n.jsxs(n.Fragment,{children:[t.type==="youtube"&&m&&!P.current&&n.jsx("div",{className:"absolute top-3 left-3 z-10 px-3 py-1.5 rounded-lg bg-black/60 text-white/90 text-sm",children:"Click the video to start playback"}),n.jsx("button",{onClick:G,className:"absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-black/60 hover:bg-black/80 text-white/80 hover:text-white transition-all cursor-pointer",children:"âœ•"})]}),t.type==="video"?n.jsx("video",{autoPlay:!0,loop:!0,muted:i,controls:_,playsInline:!0,className:"w-full h-full object-cover",children:n.jsx("source",{src:t.url,type:"video/mp4"})},t.url):n.jsx(Be,{videoId:Y(t.url)||"",opts:de,onReady:le,onStateChange:ce,onError:ue,className:"w-full h-full",iframeClassName:`w-full h-full ${_?"":"pointer-events-none"}`,style:{width:"100%",height:"100%"}},t.url)]})})]}),K=()=>n.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:n.jsx(Ve,{type:r})}),fe=n.jsxs("div",{ref:D,className:"absolute inset-0 w-full h-full -z-10 overflow-hidden bg-black",style:{filter:H(),transformOrigin:"center center",transition:"filter 700ms ease-in-out, opacity 700ms ease-in-out"},children:[t.type==="color"&&n.jsx("div",{className:"w-full h-full",style:{backgroundColor:t.url}}),t.type==="gradient"&&n.jsx("div",{className:"w-full h-full",style:{background:t.url}}),t.type==="image"&&n.jsxs(n.Fragment,{children:[t.thumbnail&&!S&&n.jsx("img",{src:t.thumbnail,alt:"background thumbnail",className:"w-full h-full object-cover blur-sm scale-105"}),n.jsx("img",{src:t.url,alt:"background",loading:"eager",className:`w-full h-full object-cover transition-opacity duration-700 ${S?"opacity-100":"opacity-0"}`,style:{position:t.thumbnail?"absolute":"relative"}}),n.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),(t.type==="video"||t.type==="youtube"&&!e&&!A)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-0 bg-black/20"}),o?J():X.createPortal(J(),document.body)]}),t.type==="youtube"&&(e||A)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-full h-full",style:{backgroundColor:"#1a1a1a"}}),n.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),r==="sun-rays"&&n.jsxs("div",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-hidden z-10",children:[n.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[80vw] h-[80vw] bg-[radial-gradient(circle,rgba(255,220,150,0.4)_0%,rgba(0,0,0,0)_70%)] blur-[80px]"}),n.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-40 mix-blend-overlay origin-center animate-[spin_120s_linear_infinite]",children:n.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_0deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,255,0.1)_15deg,rgba(0,0,0,0)_30deg,rgba(255,200,100,0.1)_45deg,rgba(0,0,0,0)_60deg,rgba(255,255,255,0.1)_90deg,rgba(0,0,0,0)_130deg)]"})}),n.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-30 mix-blend-soft-light origin-center animate-[spin_180s_linear_infinite_reverse]",children:n.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_180deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,200,0.1)_10deg,rgba(0,0,0,0)_20deg,rgba(255,255,255,0.05)_40deg,rgba(0,0,0,0)_80deg)]"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-transparent to-orange-200/20 mix-blend-screen"})]})]}),me=o?K():X.createPortal(K(),document.body);return n.jsxs(n.Fragment,{children:[fe,me]})}const dt=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{je as A,at as B,ot as C,it as D,lt as E,st as F,nt as G,ct as H,Fe as I,ut as J,j as K,ae as L,dt as M,re as _,Le as a,Ze as b,Oe as c,qe as d,Ue as e,He as f,Ge as g,et as h,tt as i,Se as j,Re as k,xe as l,Ye as m,ze as n,Me as o,We as p,Ce as q,Je as r,Ee as s,Ke as t,ve as u,Qe as v,Xe as w,Pe as x,$e as y,rt as z};
