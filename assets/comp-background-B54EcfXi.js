const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./comp-effectslayer-aY2f5Gu_.js","./vendor-COPaNxkS.js"])))=>i.map(i=>d[i]);
import{c as ue,p as de,j as n,L as fe,r as w,a as W,l as K}from"./vendor-COPaNxkS.js";import{D as Q,a as X,b as me}from"./comp-audiocontroller-Cl3Cj2Ve.js";const ge="modulepreload",he=function(e,i){return new URL(e,i).href},J={},ee=function(i,t,r){let o=Promise.resolve();if(t&&t.length>0){let h=function(l){return Promise.all(l.map(p=>Promise.resolve(p).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};const g=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),S=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=h(t.map(l=>{if(l=he(l,r),l in J)return;J[l]=!0;const p=l.endsWith(".css"),x=p?'[rel="stylesheet"]':"";if(!!r)for(let m=g.length-1;m>=0;m--){const E=g[m];if(E.href===l&&(!p||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${x}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":ge,p||(v.as="script"),v.crossOrigin="",v.href=l,S&&v.setAttribute("nonce",S),document.head.appendChild(v),p)return new Promise((m,E)=>{v.addEventListener("load",m),v.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${l}`)))})}))}function d(h){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=h,window.dispatchEvent(g),!g.defaultPrevented)throw h}return o.then(h=>{for(const g of h||[])g.status==="rejected"&&d(g.reason);return i().catch(d)})},c=ue()(de((e,i)=>({currentScene:me[0],setCurrentScene:t=>e({currentScene:t}),currentEffect:"none",setCurrentEffect:t=>e({currentEffect:t}),timerMode:"pomodoro",showTimer:!0,setTimerMode:t=>e({timerMode:t}),setShowTimer:t=>e({showTimer:t}),showVisualizer:!1,visualizerMode:"window",setShowVisualizer:t=>e({showVisualizer:t}),setVisualizerMode:t=>e({visualizerMode:t}),isBgMuted:!0,bgFilters:X,bgInitialZoom:100,syncVisualizerConfig:Q,showVideoModal:!1,setIsBgMuted:t=>e({isBgMuted:t}),setBgFilters:t=>e({bgFilters:t}),setBgInitialZoom:t=>e({bgInitialZoom:t}),setSyncVisualizerConfig:t=>e({syncVisualizerConfig:t}),setShowVideoModal:t=>e({showVideoModal:t}),tasks:[],setTasks:t=>e(r=>({tasks:typeof t=="function"?t(r.tasks):t})),addTask:t=>e(r=>({tasks:[...r.tasks,t]})),toggleTask:t=>e(r=>({tasks:r.tasks.map(o=>o.id===t?{...o,completed:!o.completed}:o)})),deleteTask:t=>e(r=>({tasks:r.tasks.filter(o=>o.id!==t)})),notes:[],setNotes:t=>e(r=>({notes:typeof t=="function"?t(r.notes):t})),addNote:t=>e(r=>({notes:[t,...r.notes]})),updateNote:(t,r)=>e(o=>({notes:o.notes.map(d=>d.id===t?{...d,...r,updatedAt:Date.now()}:d)})),deleteNote:t=>e(r=>({notes:r.notes.filter(o=>o.id!==t)}))}),{name:"ifocus-storage",partialize:e=>({currentScene:e.currentScene,currentEffect:e.currentEffect,timerMode:e.timerMode,showTimer:e.showTimer,showVisualizer:e.showVisualizer,visualizerMode:e.visualizerMode,isBgMuted:e.isBgMuted,bgFilters:e.bgFilters,bgInitialZoom:e.bgInitialZoom,syncVisualizerConfig:e.syncVisualizerConfig,tasks:e.tasks,notes:e.notes})})),ye=()=>c(e=>e.currentScene),Ve=()=>c(e=>e.setCurrentScene),be=()=>c(e=>e.currentEffect),Ne=()=>c(e=>e.setCurrentEffect),Ae=()=>c(e=>e.timerMode),De=()=>c(e=>e.setTimerMode),Re=()=>c(e=>e.showTimer),Le=()=>c(e=>e.setShowTimer),Pe=()=>c(e=>e.showVisualizer),$e=()=>c(e=>e.setShowVisualizer),qe=()=>c(e=>e.visualizerMode),Ze=()=>c(e=>e.setVisualizerMode),pe=()=>c(e=>e.isBgMuted),Oe=()=>c(e=>e.setIsBgMuted),we=()=>c(e=>e.bgFilters),Ue=()=>c(e=>e.setBgFilters),Se=()=>c(e=>e.bgInitialZoom),He=()=>c(e=>e.setBgInitialZoom),ve=()=>c(e=>e.syncVisualizerConfig),Ge=()=>c(e=>e.setSyncVisualizerConfig),xe=()=>c(e=>e.showVideoModal),ke=()=>c(e=>e.setShowVideoModal),Ye=()=>c(e=>e.tasks),We=()=>c(e=>e.setTasks),Je=()=>c(e=>e.notes),Ke=()=>c(e=>e.setNotes),te=n.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:n.jsx(fe,{className:"w-6 h-6 text-white/50 animate-spin"})});let M=null,u=null,b=null,V=null,L=!1;const se={fftSize:8192,smoothingTimeConstant:.03,minDecibels:-85,maxDecibels:-22,freqStartIndex:4,freqLength:25},_={...se};function Qe(){return{...se}}function Xe(){return{..._}}function et(e){Object.assign(_,e),u&&(e.fftSize!==void 0&&(u.fftSize=e.fftSize,b=new Uint8Array(u.frequencyBinCount)),e.smoothingTimeConstant!==void 0&&(u.smoothingTimeConstant=e.smoothingTimeConstant),e.minDecibels!==void 0&&(u.minDecibels=e.minDecibels),e.maxDecibels!==void 0&&(u.maxDecibels=e.maxDecibels))}async function tt(){if(L&&u)return!0;try{V=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser"},audio:{suppressLocalAudioPlayback:!1},selfBrowserSurface:"include",systemAudio:"include",surfaceSwitching:"include",monitorTypeSurfaces:"include"});const e=V.getAudioTracks();return e.length===0?(console.warn("No audio track in the captured stream"),$(),!1):(M=new AudioContext,u=M.createAnalyser(),u.fftSize=_.fftSize,u.smoothingTimeConstant=_.smoothingTimeConstant,u.minDecibels=_.minDecibels,u.maxDecibels=_.maxDecibels,b=new Uint8Array(u.frequencyBinCount),M.createMediaStreamSource(V).connect(u),e[0].addEventListener("ended",()=>{$()}),L=!0,!0)}catch(e){return console.error("Failed to start audio capture:",e),$(),!1}}function $(){V&&(V.getTracks().forEach(e=>e.stop()),V=null),M&&(M.close(),M=null),u=null,b=null,L=!1}function Me(){return!u||!b?new Uint8Array(64).fill(0):(u.getByteFrequencyData(b),b)}function Ee(e,i=3,t=1){const r=Math.floor(i/2),o=1/(2*r+1);let d=e.slice(),h=[];for(let g=0;g<t;g++){for(let f=0;f<r;f++)h[f]=d[f],h[d.length-f-1]=d[d.length-f-1];for(let f=r;f<d.length-r;f++){let S=0;for(let l=-r;l<=r;l++)S+=o*d[f+l]+l;h[f]=S}d=h}return h}function st(){const e=Me(),i=_.freqStartIndex,t=Math.min(i+_.freqLength,e.length),o=Array.from(e.slice(i,t)).map(d=>d/255);return Ee(o,5,2)}function Ce(){return L&&u!==null}const y={energyHistory:[],historySize:43,beatThreshold:1.3,beatCooldown:0,cooldownFrames:8,lastBeatIntensity:0,beatDecay:.92};function ze(){if(!u||!b||!M)return 0;u.getByteFrequencyData(b);const e=M.sampleRate,i=u.fftSize,t=b.length,r=Math.max(1,Math.round(20*i/e)),o=Math.min(t,Math.round(250*i/e)),d=Math.max(1,o-r);let h=0;for(let g=r;g<o&&g<t;g++)h+=b[g];return h/(d*255)}function B(e,i,t){return Math.round(e*i/t)}function nt(){if(!u||!b||!M)return{bass:0,mid:0,high:0};u.getByteFrequencyData(b);const e=M.sampleRate,i=u.fftSize,t=b.length,r=Math.max(1,B(20,i,e)),o=Math.min(t,B(250,i,e)),d=Math.min(t,B(250,i,e)),h=Math.min(t,B(2e3,i,e)),g=Math.min(t,B(2e3,i,e)),f=Math.min(t,B(16e3,i,e));let S=0;const l=Math.max(1,o-r);for(let m=r;m<o&&m<t;m++)S+=b[m];let p=0;const x=Math.max(1,h-d);for(let m=d;m<h&&m<t;m++)p+=b[m];let I=0;const v=Math.max(1,f-g);for(let m=g;m<f&&m<t;m++)I+=b[m];return{bass:S/(l*255),mid:p/(x*255),high:I/(v*255)}}function _e(){const e=ze();if(y.energyHistory.push(e),y.energyHistory.length>y.historySize&&y.energyHistory.shift(),y.energyHistory.length<10)return y.lastBeatIntensity*=y.beatDecay;const i=y.energyHistory.reduce((r,o)=>r+o,0)/y.energyHistory.length;if(y.beatCooldown>0&&y.beatCooldown--,y.beatCooldown===0&&e>i*y.beatThreshold&&e>.1){const r=Math.min(1,(e-i)/i);y.lastBeatIntensity=Math.max(y.lastBeatIntensity,r),y.beatCooldown=y.cooldownFrames}return y.lastBeatIntensity*=y.beatDecay,y.lastBeatIntensity}const je=K(()=>ee(()=>import("./vendor-COPaNxkS.js").then(e=>e.Y),[],import.meta.url),{fallback:te}),Ie=K(()=>ee(()=>import("./comp-effectslayer-aY2f5Gu_.js"),__vite__mapDeps([0,1]),import.meta.url),{fallback:te});function Te({disableYouTube:e=!1,isInPiP:i=!1}){const t=ye(),r=be(),o=pe(),d=we(),h=Se(),g=ve(),f=xe(),S=ke(),l=w.useRef(null),[p,x]=w.useState(!1),[I,v]=w.useState(!1),[m,E]=w.useState(!1),N=w.useRef(!1),C=f||m,T=w.useRef(null),F=w.useRef(null),P=w.useRef(0),j={...Q,...g},q=()=>{const s=[],a={...X,...d};return a.blur>0&&s.push(`blur(${a.blur}px)`),a.brightness!==100&&s.push(`brightness(${a.brightness}%)`),a.contrast!==100&&s.push(`contrast(${a.contrast}%)`),a.grayscale>0&&s.push(`grayscale(${a.grayscale}%)`),a.hueRotate!==0&&s.push(`hue-rotate(${a.hueRotate}deg)`),a.invert>0&&s.push(`invert(${a.invert}%)`),a.opacity!==100&&s.push(`opacity(${a.opacity}%)`),a.saturate!==100&&s.push(`saturate(${a.saturate}%)`),a.sepia>0&&s.push(`sepia(${a.sepia}%)`),s.length>0?s.join(" "):"none"},ne=()=>h/100;w.useEffect(()=>{const s=ne();if(!j.enabled){T.current&&(T.current.style.transform=`scale(${s})`),F.current&&(F.current.style.transform=`scale(${s})`);return}let a=s;const z=()=>{const A=k=>{k&&(k.style.transform=`scale(${a})`)};if(Ce()){const k=_e(),R=s+k*j.intensity;a+=(R-a)*j.speed}else a+=(s-a)*j.speed;A(T.current),A(F.current),P.current=requestAnimationFrame(z)};return P.current=requestAnimationFrame(z),()=>{cancelAnimationFrame(P.current),T.current&&(T.current.style.transform=`scale(${s})`),F.current&&(F.current.style.transform=`scale(${s})`)}},[j.enabled,j.speed,j.intensity,h]);const Z=()=>{S(!1),E(!1)},O=s=>{const a=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,z=s.match(a);return z&&z[2].length===11?z[2]:null};w.useEffect(()=>{if(x(!1),S(!1),E(!1),N.current=!1,t.type==="image"){const s=new Image;s.onload=()=>x(!0),s.src=t.url}return()=>{l.current=null}},[t.url,t.type,S]),w.useEffect(()=>{if(l.current&&t.type==="youtube")try{o?l.current.mute():l.current.unMute()}catch(s){console.warn("Error changing mute state:",s)}},[o,t.type]);const U=w.useCallback(()=>{var s,a,z,A;if(!(!l.current||N.current))try{const k=(a=(s=l.current).getPlayerState)==null?void 0:a.call(s);if(k===void 0)return;k!==1&&k!==3&&((A=(z=l.current).playVideo)==null||A.call(z),setTimeout(()=>{var R,Y;if(l.current)try{const D=(Y=(R=l.current).getPlayerState)==null?void 0:Y.call(R);D!==void 0&&D!==1&&D!==3&&!N.current&&E(!0)}catch(D){console.warn("Error checking player state:",D)}},500))}catch(k){console.warn("Error checking YouTube player state:",k)}},[]);w.useEffect(()=>{if(t.type!=="youtube"||e)return;const s=()=>{U()};return window.addEventListener("click",s),()=>window.removeEventListener("click",s)},[t.type,e,U]);const re=s=>{try{l.current=s.target,o?s.target.mute():s.target.unMute(),s.target.playVideo()}catch(a){console.warn("Error in onPlayerReady:",a)}},ae=s=>{try{s.data===1&&(N.current=!0,E(!1))}catch(a){console.warn("Error in onPlayerStateChange:",a)}},oe=s=>{console.error("YouTube player error:",s.data),s.data===150||s.data===101?console.warn("Video may be unavailable or embedding restricted"):v(!0)},ie={playerVars:{autoplay:1,mute:1,controls:1,loop:1,playlist:t.type==="youtube"&&O(t.url)||"",playsinline:1,showinfo:0,rel:0,iv_load_policy:3,disablekb:1,modestbranding:1}},H=()=>n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
                @keyframes modalFadeIn {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
              `}),C&&n.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm",style:{zIndex:99998,animation:"modalFadeIn 0.3s ease-out forwards"},onClick:Z}),n.jsx("div",{ref:C?void 0:F,className:C?"contents":"fixed inset-0 w-full h-full overflow-hidden",style:C?void 0:{zIndex:-1,filter:q(),transformOrigin:"center center",transition:"filter 700ms ease-in-out"},children:n.jsxs("div",{className:C?"fixed w-[80vw] max-w-4xl aspect-video left-1/2 top-1/2 rounded-xl overflow-hidden shadow-2xl border border-white/10 bg-black":"w-full h-full",style:C?{zIndex:99999,transform:"translate(-50%, -50%)",animation:"modalFadeIn 0.3s ease-out forwards"}:{pointerEvents:"none"},children:[C&&n.jsxs(n.Fragment,{children:[t.type==="youtube"&&m&&!N.current&&n.jsx("div",{className:"absolute top-3 left-3 z-10 px-3 py-1.5 rounded-lg bg-black/60 text-white/90 text-sm",children:"Click the video to start playback"}),n.jsx("button",{onClick:Z,className:"absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-black/60 hover:bg-black/80 text-white/80 hover:text-white transition-all cursor-pointer",children:"âœ•"})]}),t.type==="video"?n.jsx("video",{autoPlay:!0,loop:!0,muted:o,controls:C,playsInline:!0,className:"w-full h-full object-cover",children:n.jsx("source",{src:t.url,type:"video/mp4"})},t.url):n.jsx(je,{videoId:O(t.url)||"",opts:ie,onReady:re,onStateChange:ae,onError:oe,className:"w-full h-full",iframeClassName:`w-full h-full ${C?"":"pointer-events-none"}`,style:{width:"100%",height:"100%"}},t.url)]})})]}),G=()=>n.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:n.jsx(Ie,{type:r})}),le=n.jsxs("div",{ref:T,className:"absolute inset-0 w-full h-full -z-10 overflow-hidden bg-black",style:{filter:q(),transformOrigin:"center center",transition:"filter 700ms ease-in-out, opacity 700ms ease-in-out"},children:[t.type==="color"&&n.jsx("div",{className:"w-full h-full",style:{backgroundColor:t.url}}),t.type==="gradient"&&n.jsx("div",{className:"w-full h-full",style:{background:t.url}}),t.type==="image"&&n.jsxs(n.Fragment,{children:[t.thumbnail&&!p&&n.jsx("img",{src:t.thumbnail,alt:"background thumbnail",className:"w-full h-full object-cover blur-sm scale-105"}),n.jsx("img",{src:t.url,alt:"background",loading:"eager",className:`w-full h-full object-cover transition-opacity duration-700 ${p?"opacity-100":"opacity-0"}`,style:{position:t.thumbnail?"absolute":"relative"}}),n.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),(t.type==="video"||t.type==="youtube"&&!e&&!I)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-0 bg-black/20"}),i?H():W.createPortal(H(),document.body)]}),t.type==="youtube"&&(e||I)&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-full h-full",style:{backgroundColor:"#1a1a1a"}}),n.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),r==="sun-rays"&&n.jsxs("div",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-hidden z-10",children:[n.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[80vw] h-[80vw] bg-[radial-gradient(circle,rgba(255,220,150,0.4)_0%,rgba(0,0,0,0)_70%)] blur-[80px]"}),n.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-40 mix-blend-overlay origin-center animate-[spin_120s_linear_infinite]",children:n.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_0deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,255,0.1)_15deg,rgba(0,0,0,0)_30deg,rgba(255,200,100,0.1)_45deg,rgba(0,0,0,0)_60deg,rgba(255,255,255,0.1)_90deg,rgba(0,0,0,0)_130deg)]"})}),n.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-30 mix-blend-soft-light origin-center animate-[spin_180s_linear_infinite_reverse]",children:n.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_180deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,200,0.1)_10deg,rgba(0,0,0,0)_20deg,rgba(255,255,255,0.05)_40deg,rgba(0,0,0,0)_80deg)]"})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-transparent to-orange-200/20 mix-blend-screen"})]})]}),ce=i?G():W.createPortal(G(),document.body);return n.jsxs(n.Fragment,{children:[le,ce]})}const rt=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Ce as A,tt as B,Qe as C,Xe as D,st as E,_e as F,nt as G,$ as H,rt as I,te as L,ee as _,Ne as a,Pe as b,$e as c,Re as d,Le as e,qe as f,Ze as g,Je as h,Ke as i,ye as j,Ve as k,pe as l,Oe as m,ke as n,we as o,Ue as p,Se as q,He as r,ve as s,Ge as t,be as u,Ye as v,We as w,Ae as x,De as y,et as z};
