const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./comp-effectslayer-Cx7LVRfV.js","./vendor-woyHwGIK.js"])))=>i.map(i=>d[i]);
import{c as ce,p as ue,j as r,L as de,r as y,a as Y,l as J}from"./vendor-woyHwGIK.js";import{D as K,a as Q,b as fe}from"./comp-audiocontroller-B2mKwfGK.js";const me="modulepreload",ge=function(e,c){return new URL(e,c).href},W={},X=function(c,t,n){let l=Promise.resolve();if(t&&t.length>0){let g=function(a){return Promise.all(a.map(b=>Promise.resolve(b).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};const h=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),S=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));l=g(t.map(a=>{if(a=ge(a,n),a in W)return;W[a]=!0;const b=a.endsWith(".css"),C=b?'[rel="stylesheet"]':"";if(!!n)for(let _=h.length-1;_>=0;_--){const x=h[_];if(x.href===a&&(!b||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${C}`))return;const p=document.createElement("link");if(p.rel=b?"stylesheet":me,b||(p.as="script"),p.crossOrigin="",p.href=a,S&&p.setAttribute("nonce",S),document.head.appendChild(p),b)return new Promise((_,x)=>{p.addEventListener("load",_),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${a}`)))})}))}function m(g){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=g,window.dispatchEvent(h),!h.defaultPrevented)throw g}return l.then(g=>{for(const h of g||[])h.status==="rejected"&&m(h.reason);return c().catch(m)})},i=ce()(ue((e,c)=>({currentScene:fe[0],setCurrentScene:t=>e({currentScene:t}),currentEffect:"none",setCurrentEffect:t=>e({currentEffect:t}),timerMode:"pomodoro",showTimer:!0,setTimerMode:t=>e({timerMode:t}),setShowTimer:t=>e({showTimer:t}),showVisualizer:!1,visualizerMode:"window",setShowVisualizer:t=>e({showVisualizer:t}),setVisualizerMode:t=>e({visualizerMode:t}),isBgMuted:!0,bgFilters:Q,bgInitialZoom:100,syncVisualizerConfig:K,showVideoModal:!1,setIsBgMuted:t=>e({isBgMuted:t}),setBgFilters:t=>e({bgFilters:t}),setBgInitialZoom:t=>e({bgInitialZoom:t}),setSyncVisualizerConfig:t=>e({syncVisualizerConfig:t}),setShowVideoModal:t=>e({showVideoModal:t}),tasks:[],setTasks:t=>e(n=>({tasks:typeof t=="function"?t(n.tasks):t})),addTask:t=>e(n=>({tasks:[...n.tasks,t]})),toggleTask:t=>e(n=>({tasks:n.tasks.map(l=>l.id===t?{...l,completed:!l.completed}:l)})),deleteTask:t=>e(n=>({tasks:n.tasks.filter(l=>l.id!==t)})),notes:[],setNotes:t=>e(n=>({notes:typeof t=="function"?t(n.notes):t})),addNote:t=>e(n=>({notes:[t,...n.notes]})),updateNote:(t,n)=>e(l=>({notes:l.notes.map(m=>m.id===t?{...m,...n,updatedAt:Date.now()}:m)})),deleteNote:t=>e(n=>({notes:n.notes.filter(l=>l.id!==t)}))}),{name:"ifocus-storage",partialize:e=>({currentScene:e.currentScene,currentEffect:e.currentEffect,timerMode:e.timerMode,showTimer:e.showTimer,showVisualizer:e.showVisualizer,visualizerMode:e.visualizerMode,isBgMuted:e.isBgMuted,bgFilters:e.bgFilters,bgInitialZoom:e.bgInitialZoom,syncVisualizerConfig:e.syncVisualizerConfig,tasks:e.tasks,notes:e.notes})})),he=()=>i(e=>e.currentScene),Ve=()=>i(e=>e.setCurrentScene),ye=()=>i(e=>e.currentEffect),Be=()=>i(e=>e.setCurrentEffect),Ne=()=>i(e=>e.timerMode),Ae=()=>i(e=>e.setTimerMode),De=()=>i(e=>e.showTimer),Le=()=>i(e=>e.setShowTimer),Re=()=>i(e=>e.showVisualizer),Pe=()=>i(e=>e.setShowVisualizer),$e=()=>i(e=>e.visualizerMode),Ze=()=>i(e=>e.setVisualizerMode),be=()=>i(e=>e.isBgMuted),qe=()=>i(e=>e.setIsBgMuted),pe=()=>i(e=>e.bgFilters),Oe=()=>i(e=>e.setBgFilters),we=()=>i(e=>e.bgInitialZoom),Ue=()=>i(e=>e.setBgInitialZoom),ve=()=>i(e=>e.syncVisualizerConfig),He=()=>i(e=>e.setSyncVisualizerConfig),Se=()=>i(e=>e.showVideoModal),xe=()=>i(e=>e.setShowVideoModal),Ge=()=>i(e=>e.tasks),Ye=()=>i(e=>e.setTasks),We=()=>i(e=>e.notes),Je=()=>i(e=>e.setNotes),ee=r.jsx("div",{className:"flex items-center justify-center w-full h-full min-h-[100px]",children:r.jsx(de,{className:"w-6 h-6 text-white/50 animate-spin"})});let T=null,f=null,v=null,F=null,D=!1;const te={fftSize:8192,smoothingTimeConstant:.03,minDecibels:-85,maxDecibels:-22,freqStartIndex:4,freqLength:25},z={...te};function Ke(){return{...te}}function Qe(){return{...z}}function Xe(e){Object.assign(z,e),f&&(e.fftSize!==void 0&&(f.fftSize=e.fftSize,v=new Uint8Array(f.frequencyBinCount)),e.smoothingTimeConstant!==void 0&&(f.smoothingTimeConstant=e.smoothingTimeConstant),e.minDecibels!==void 0&&(f.minDecibels=e.minDecibels),e.maxDecibels!==void 0&&(f.maxDecibels=e.maxDecibels))}async function et(){if(D&&f)return!0;try{F=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser"},audio:{suppressLocalAudioPlayback:!1},selfBrowserSurface:"include",systemAudio:"include",surfaceSwitching:"include",monitorTypeSurfaces:"include"});const e=F.getAudioTracks();return e.length===0?(console.warn("No audio track in the captured stream"),P(),!1):(T=new AudioContext,f=T.createAnalyser(),f.fftSize=z.fftSize,f.smoothingTimeConstant=z.smoothingTimeConstant,f.minDecibels=z.minDecibels,f.maxDecibels=z.maxDecibels,v=new Uint8Array(f.frequencyBinCount),T.createMediaStreamSource(F).connect(f),e[0].addEventListener("ended",()=>{P()}),D=!0,!0)}catch(e){return console.error("Failed to start audio capture:",e),P(),!1}}function P(){F&&(F.getTracks().forEach(e=>e.stop()),F=null),T&&(T.close(),T=null),f=null,v=null,D=!1}function ke(){return!f||!v?new Uint8Array(64).fill(0):(f.getByteFrequencyData(v),v)}function Ee(e,c=3,t=1){const n=Math.floor(c/2),l=1/(2*n+1);let m=e.slice(),g=[];for(let h=0;h<t;h++){for(let u=0;u<n;u++)g[u]=m[u],g[m.length-u-1]=m[m.length-u-1];for(let u=n;u<m.length-n;u++){let S=0;for(let a=-n;a<=n;a++)S+=l*m[u+a]+a;g[u]=S}m=g}return g}function tt(){const e=ke(),c=z.freqStartIndex,t=Math.min(c+z.freqLength,e.length),l=Array.from(e.slice(c,t)).map(m=>m/255);return Ee(l,5,2)}function Ce(){return D&&f!==null}const d={energyHistory:[],historySize:43,beatThreshold:1.3,beatCooldown:0,cooldownFrames:8,lastBeatIntensity:0,beatDecay:.92};function _e(){if(!f||!v)return 0;f.getByteFrequencyData(v);const e=8;let c=0;for(let t=0;t<e&&t<v.length;t++)c+=v[t];return c/(e*255)}function ze(){const e=_e();if(d.energyHistory.push(e),d.energyHistory.length>d.historySize&&d.energyHistory.shift(),d.energyHistory.length<10)return d.lastBeatIntensity*=d.beatDecay;const c=d.energyHistory.reduce((n,l)=>n+l,0)/d.energyHistory.length;if(d.beatCooldown>0&&d.beatCooldown--,d.beatCooldown===0&&e>c*d.beatThreshold&&e>.1){const n=Math.min(1,(e-c)/c);d.lastBeatIntensity=Math.max(d.lastBeatIntensity,n),d.beatCooldown=d.cooldownFrames}return d.lastBeatIntensity*=d.beatDecay,d.lastBeatIntensity}const je=J(()=>X(()=>import("./vendor-woyHwGIK.js").then(e=>e.Y),[],import.meta.url),{fallback:ee}),Me=J(()=>X(()=>import("./comp-effectslayer-Cx7LVRfV.js"),__vite__mapDeps([0,1]),import.meta.url),{fallback:ee});function Ie({disableYouTube:e=!1,isInPiP:c=!1}){const t=he(),n=ye(),l=be(),m=pe(),g=we(),h=ve(),u=Se(),S=xe(),a=y.useRef(null),[b,C]=y.useState(!1),[L,p]=y.useState(!1),[_,x]=y.useState(!1),V=y.useRef(!1),k=u||_,M=y.useRef(null),I=y.useRef(null),R=y.useRef(0),j={...K,...h},$=()=>{const s=[],o={...Q,...m};return o.blur>0&&s.push(`blur(${o.blur}px)`),o.brightness!==100&&s.push(`brightness(${o.brightness}%)`),o.contrast!==100&&s.push(`contrast(${o.contrast}%)`),o.grayscale>0&&s.push(`grayscale(${o.grayscale}%)`),o.hueRotate!==0&&s.push(`hue-rotate(${o.hueRotate}deg)`),o.invert>0&&s.push(`invert(${o.invert}%)`),o.opacity!==100&&s.push(`opacity(${o.opacity}%)`),o.saturate!==100&&s.push(`saturate(${o.saturate}%)`),o.sepia>0&&s.push(`sepia(${o.sepia}%)`),s.length>0?s.join(" "):"none"},se=()=>g/100;y.useEffect(()=>{const s=se();if(!j.enabled){M.current&&(M.current.style.transform=`scale(${s})`),I.current&&(I.current.style.transform=`scale(${s})`);return}let o=s;const E=()=>{const B=w=>{w&&(w.style.transform=`scale(${o})`)};if(Ce()){const w=ze(),A=s+w*j.intensity;o+=(A-o)*j.speed}else o+=(s-o)*j.speed;B(M.current),B(I.current),R.current=requestAnimationFrame(E)};return R.current=requestAnimationFrame(E),()=>{cancelAnimationFrame(R.current),M.current&&(M.current.style.transform=`scale(${s})`),I.current&&(I.current.style.transform=`scale(${s})`)}},[j.enabled,j.speed,j.intensity,g]);const Z=()=>{S(!1),x(!1)},q=s=>{const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,E=s.match(o);return E&&E[2].length===11?E[2]:null};y.useEffect(()=>{if(C(!1),S(!1),x(!1),V.current=!1,t.type==="image"){const s=new Image;s.onload=()=>C(!0),s.src=t.url}return()=>{a.current=null}},[t.url,t.type,S]),y.useEffect(()=>{if(a.current&&t.type==="youtube")try{l?a.current.mute():a.current.unMute()}catch(s){console.warn("Error changing mute state:",s)}},[l,t.type]);const O=y.useCallback(()=>{var s,o,E,B;if(!(!a.current||V.current))try{const w=(o=(s=a.current).getPlayerState)==null?void 0:o.call(s);if(w===void 0)return;w!==1&&w!==3&&((B=(E=a.current).playVideo)==null||B.call(E),setTimeout(()=>{var A,G;if(a.current)try{const N=(G=(A=a.current).getPlayerState)==null?void 0:G.call(A);N!==void 0&&N!==1&&N!==3&&!V.current&&x(!0)}catch(N){console.warn("Error checking player state:",N)}},500))}catch(w){console.warn("Error checking YouTube player state:",w)}},[]);y.useEffect(()=>{if(t.type!=="youtube"||e)return;const s=()=>{O()};return window.addEventListener("click",s),()=>window.removeEventListener("click",s)},[t.type,e,O]);const re=s=>{try{a.current=s.target,l?s.target.mute():s.target.unMute(),s.target.playVideo()}catch(o){console.warn("Error in onPlayerReady:",o)}},ne=s=>{try{s.data===1&&(V.current=!0,x(!1))}catch(o){console.warn("Error in onPlayerStateChange:",o)}},oe=s=>{console.error("YouTube player error:",s.data),s.data===150||s.data===101?console.warn("Video may be unavailable or embedding restricted"):p(!0)},ae={playerVars:{autoplay:1,mute:1,controls:1,loop:1,playlist:t.type==="youtube"&&q(t.url)||"",playsinline:1,showinfo:0,rel:0,iv_load_policy:3,disablekb:1,modestbranding:1}},U=()=>r.jsxs(r.Fragment,{children:[r.jsx("style",{children:`
                @keyframes modalFadeIn {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
              `}),k&&r.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm",style:{zIndex:99998,animation:"modalFadeIn 0.3s ease-out forwards"},onClick:Z}),r.jsx("div",{ref:k?void 0:I,className:k?"contents":"fixed inset-0 w-full h-full overflow-hidden",style:k?void 0:{zIndex:-1,filter:$(),transformOrigin:"center center",transition:"filter 700ms ease-in-out"},children:r.jsxs("div",{className:k?"fixed w-[80vw] max-w-4xl aspect-video left-1/2 top-1/2 rounded-xl overflow-hidden shadow-2xl border border-white/10 bg-black":"w-full h-full",style:k?{zIndex:99999,transform:"translate(-50%, -50%)",animation:"modalFadeIn 0.3s ease-out forwards"}:{pointerEvents:"none"},children:[k&&r.jsxs(r.Fragment,{children:[t.type==="youtube"&&_&&!V.current&&r.jsx("div",{className:"absolute top-3 left-3 z-10 px-3 py-1.5 rounded-lg bg-black/60 text-white/90 text-sm",children:"Click the video to start playback"}),r.jsx("button",{onClick:Z,className:"absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-black/60 hover:bg-black/80 text-white/80 hover:text-white transition-all cursor-pointer",children:"âœ•"})]}),t.type==="video"?r.jsx("video",{autoPlay:!0,loop:!0,muted:l,controls:k,playsInline:!0,className:"w-full h-full object-cover",children:r.jsx("source",{src:t.url,type:"video/mp4"})},t.url):r.jsx(je,{videoId:q(t.url)||"",opts:ae,onReady:re,onStateChange:ne,onError:oe,className:"w-full h-full",iframeClassName:`w-full h-full ${k?"":"pointer-events-none"}`,style:{width:"100%",height:"100%"}},t.url)]})})]}),H=()=>r.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:r.jsx(Me,{type:n})}),ie=r.jsxs("div",{ref:M,className:"absolute inset-0 w-full h-full -z-10 overflow-hidden bg-black",style:{filter:$(),transformOrigin:"center center",transition:"filter 700ms ease-in-out, opacity 700ms ease-in-out"},children:[t.type==="color"&&r.jsx("div",{className:"w-full h-full",style:{backgroundColor:t.url}}),t.type==="gradient"&&r.jsx("div",{className:"w-full h-full",style:{background:t.url}}),t.type==="image"&&r.jsxs(r.Fragment,{children:[t.thumbnail&&!b&&r.jsx("img",{src:t.thumbnail,alt:"background thumbnail",className:"w-full h-full object-cover blur-sm scale-105"}),r.jsx("img",{src:t.url,alt:"background",loading:"eager",className:`w-full h-full object-cover transition-opacity duration-700 ${b?"opacity-100":"opacity-0"}`,style:{position:t.thumbnail?"absolute":"relative"}}),r.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),(t.type==="video"||t.type==="youtube"&&!e&&!L)&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"absolute inset-0 bg-black/20"}),c?U():Y.createPortal(U(),document.body)]}),t.type==="youtube"&&(e||L)&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-full h-full",style:{backgroundColor:"#1a1a1a"}}),r.jsx("div",{className:"absolute inset-0 bg-black/20"})]}),n==="sun-rays"&&r.jsxs("div",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-hidden z-10",children:[r.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[80vw] h-[80vw] bg-[radial-gradient(circle,rgba(255,220,150,0.4)_0%,rgba(0,0,0,0)_70%)] blur-[80px]"}),r.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-40 mix-blend-overlay origin-center animate-[spin_120s_linear_infinite]",children:r.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_0deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,255,0.1)_15deg,rgba(0,0,0,0)_30deg,rgba(255,200,100,0.1)_45deg,rgba(0,0,0,0)_60deg,rgba(255,255,255,0.1)_90deg,rgba(0,0,0,0)_130deg)]"})}),r.jsx("div",{className:"absolute -top-[50%] -right-[50%] w-[200%] h-[200%] opacity-30 mix-blend-soft-light origin-center animate-[spin_180s_linear_infinite_reverse]",children:r.jsx("div",{className:"w-full h-full bg-[conic-gradient(from_180deg_at_50%_50%,rgba(0,0,0,0)_0deg,rgba(255,255,200,0.1)_10deg,rgba(0,0,0,0)_20deg,rgba(255,255,255,0.05)_40deg,rgba(0,0,0,0)_80deg)]"})}),r.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-transparent to-orange-200/20 mix-blend-screen"})]})]}),le=c?H():Y.createPortal(H(),document.body);return r.jsxs(r.Fragment,{children:[ie,le]})}const st=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{Ce as A,et as B,Ke as C,Qe as D,tt as E,ze as F,P as G,st as H,ee as L,X as _,Be as a,Re as b,Pe as c,De as d,Le as e,$e as f,Ze as g,We as h,Je as i,he as j,Ve as k,be as l,qe as m,xe as n,pe as o,Oe as p,we as q,Ue as r,ve as s,He as t,ye as u,Ge as v,Ye as w,Ne as x,Ae as y,Xe as z};
