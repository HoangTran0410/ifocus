const n={particles:[],orbitAngle:0,lastBeat:0};function I({ctx:e,canvas:d,data:g,performanceMode:M=!1,beatIntensity:m=0,bass:c=0,high:w=0}){const s=d.width/2,f=d.height/2,h=g.reduce((t,i)=>t+i,0)/g.length,v=M?80:200;if(n.orbitAngle+=.02+h*.03,c>.4&&Date.now()-n.lastBeat>100){const t=M?8:20;for(let i=0;i<t;i++){const a=i/t*Math.PI*2+Math.random()*.3,r=4+c*10+Math.random()*4;n.particles.push({x:s,y:f,vx:Math.cos(a)*r,vy:Math.sin(a)*r,size:3+c*5,life:1,maxLife:1,hue:280+Math.random()*60,type:"burst"})}n.lastBeat=Date.now()}const S=Math.floor(h*4)+1;for(let t=0;t<S&&n.particles.length<v;t++){const i=Math.floor(Math.random()*g.length),a=g[i];if(a>.25)if(Math.random()<.6){const l=50+Math.random()*100,o=n.orbitAngle+Math.random()*Math.PI*2;n.particles.push({x:s+Math.cos(o)*l,y:f+Math.sin(o)*l,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:2+a*4,life:1,maxLife:1,hue:260+i/g.length*80,type:"orbit"})}else n.particles.push({x:s+(Math.random()-.5)*d.width*.6,y:d.height+10,vx:(Math.random()-.5)*1,vy:-2-a*4-Math.random()*2,size:2+a*3,life:1,maxLife:1,hue:320+Math.random()*40,type:"trail"})}if(n.particles=n.particles.filter(t=>{if(t.type==="orbit"){const l=s-t.x,o=f-t.y,y=Math.sqrt(l*l+o*o),b=.1+h*.15;t.vx+=o/y*b-l/y*.02,t.vy+=-l/y*b-o/y*.02,t.vx*=.99,t.vy*=.99}else t.type==="trail"?(t.vx+=Math.sin(t.y*.02)*.1,t.vy*=.995):(t.vx*=.96,t.vy*=.96);if(t.x+=t.vx,t.y+=t.vy,t.life-=t.type==="trail"?.008:.012,t.life<=0||t.y<-20||t.x<-20||t.x>d.width+20)return!1;const i=t.life/t.maxLife,a=t.size*i;!M&&a>2&&(e.beginPath(),e.arc(t.x,t.y,a*2.5,0,Math.PI*2),e.fillStyle=`hsla(${t.hue}, 100%, 60%, ${i*.2})`,e.fill()),e.beginPath(),e.arc(t.x,t.y,a,0,Math.PI*2);const r=55+i*25;return e.fillStyle=`hsla(${t.hue}, 90%, ${r}%, ${i*.9})`,e.fill(),t.type==="burst"&&i>.5&&(e.beginPath(),e.arc(t.x,t.y,a*.4,0,Math.PI*2),e.fillStyle=`rgba(255, 255, 255, ${i*.8})`,e.fill()),!0}),!M){const t=n.particles.filter(i=>i.type==="orbit"&&i.life>.3);for(let i=0;i<t.length;i++)for(let a=i+1;a<t.length;a++){const r=t[i],l=t[a],o=l.x-r.x,y=l.y-r.y,b=Math.sqrt(o*o+y*y);if(b<80){const $=(1-b/80)*.3*Math.min(r.life,l.life);e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(l.x,l.y),e.strokeStyle=`rgba(168, 85, 247, ${$})`,e.lineWidth=1,e.stroke()}}}const P=20+h*30+m*20,u=e.createRadialGradient(s,f,0,s,f,P*2);if(u.addColorStop(0,`rgba(255, 255, 255, ${.5+h*.3})`),u.addColorStop(.3,`rgba(200, 100, 255, ${.4+h*.3})`),u.addColorStop(.6,`rgba(168, 85, 247, ${.2+h*.2})`),u.addColorStop(1,"transparent"),e.beginPath(),e.arc(s,f,P*2,0,Math.PI*2),e.fillStyle=u,e.fill(),e.beginPath(),e.arc(s,f,P*.4,0,Math.PI*2),e.fillStyle=`rgba(255, 255, 255, ${.6+m*.4})`,e.fill(),!M)for(let t=0;t<2;t++){const i=60+t*40+h*20;e.beginPath(),e.arc(s,f,i,0,Math.PI*2),e.strokeStyle=`rgba(168, 85, 247, ${.15+h*.1})`,e.lineWidth=1,e.stroke()}}export{I as default};
