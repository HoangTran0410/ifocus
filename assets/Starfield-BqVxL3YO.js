const a={stars:[],initialized:!1,shockwaves:[],lastBeatTime:0,rotation:0,coronaExplosion:null};function D({ctx:l,canvas:e,data:S,performanceMode:C=!1,beatIntensity:n=0,bass:b=0}){const t=e.width/2,r=e.height/2,P=S.reduce((o,i)=>o+i,0)/S.length,k=C?50:100,E=Date.now();if(!a.initialized||a.stars.length!==k){a.stars=[];for(let o=0;o<k;o++)a.stars.push({x:(Math.random()-.5)*e.width*2,y:(Math.random()-.5)*e.height*2,z:Math.random()*e.width,prevX:0,prevY:0});a.initialized=!0}b>.5&&E-a.lastBeatTime>400&&(a.lastBeatTime=E,a.shockwaves.push({radius:10,alpha:.5,hue:200+Math.random()*100}));const y=1+S.slice(0,Math.floor(S.length/4)).reduce((o,i)=>o+i,0)/(S.length/4)*4+b*8,F=n>.5;if(a.stars.forEach((o,i)=>{const u=o.z;o.prevX=o.x/u*e.width+t,o.prevY=o.y/u*e.height+r,o.z-=y,o.z<=0&&(o.x=(Math.random()-.5)*e.width*2,o.y=(Math.random()-.5)*e.height*2,o.z=e.width,o.prevX=o.x/o.z*e.width+t,o.prevY=o.y/o.z*e.height+r);const s=o.x/o.z*e.width+t,p=o.y/o.z*e.height+r;if(s<0||s>e.width||p<0||p>e.height)return;const f=Math.max(.5,(e.width-o.z)/e.width*3)*(1+n*.5),h=.5+(e.width-o.z)/e.width,w=i%S.length,R=S[w];let $=200+w/S.length*60;F&&($=40+w/S.length*40);const X=n>.3?.1:.3;if(!C&&h>X&&(l.beginPath(),l.moveTo(o.prevX,o.prevY),l.lineTo(s,p),l.strokeStyle=`hsla(${$}, 80%, ${60+R*30}%, ${h*(.5+n*.3)})`,l.lineWidth=f*(.5+n*.5),l.stroke()),l.beginPath(),l.arc(s,p,f,0,Math.PI*2),!C&&(h>.5||n>.4)){const m=f*(2+n*2),M=l.createRadialGradient(s,p,0,s,p,m);M.addColorStop(0,`hsla(${$}, 90%, 95%, 1)`),M.addColorStop(.3,`hsla(${$}, 80%, 80%, ${h+n*.3})`),M.addColorStop(1,"transparent"),l.fillStyle=M,l.arc(s,p,m,0,Math.PI*2)}else l.fillStyle=`hsla(${$}, 70%, ${70+h*30}%, ${h})`;l.fill()}),C||(a.shockwaves=a.shockwaves.filter(o=>(o.radius+=4+P*3,o.alpha-=.012,o.alpha<=0?!1:(l.beginPath(),l.arc(t,r,o.radius,0,Math.PI*2),l.strokeStyle=`hsla(${o.hue}, 80%, 70%, ${o.alpha})`,l.lineWidth=2+o.alpha*3,l.stroke(),l.beginPath(),l.arc(t,r,o.radius*.9,0,Math.PI*2),l.strokeStyle=`hsla(${o.hue+30}, 90%, 80%, ${o.alpha*.5})`,l.lineWidth=1,l.stroke(),!0)))),!C&&n>.5){const o=30+n*80,i=l.createRadialGradient(t,r,0,t,r,o);i.addColorStop(0,`rgba(255, 255, 255, ${n*.3})`),i.addColorStop(.3,`rgba(255, 200, 100, ${n*.15})`),i.addColorStop(1,"transparent"),l.fillStyle=i,l.beginPath(),l.arc(t,r,o,0,Math.PI*2),l.fill()}a.rotation+=.003+P*.08;const d=25+P*15+n*15;if(n>.5&&(!a.coronaExplosion||a.coronaExplosion.alpha<.3)&&(a.coronaExplosion={size:d*1.2,alpha:1,maxSize:d*5}),a.coronaExplosion){const o=a.coronaExplosion;if(o.size+=(o.maxSize-o.size)*.03,o.alpha-=.008,o.alpha>0){const i=l.createRadialGradient(t,r,d*.8,t,r,o.size);if(i.addColorStop(0,`rgba(255, 100, 50, ${o.alpha*.7})`),i.addColorStop(.3,`rgba(255, 50, 0, ${o.alpha*.5})`),i.addColorStop(.6,`rgba(200, 0, 0, ${o.alpha*.3})`),i.addColorStop(1,"transparent"),l.fillStyle=i,l.beginPath(),l.arc(t,r,o.size,0,Math.PI*2),l.fill(),!C&&o.alpha>.4)for(let s=0;s<8;s++){const p=s/8*Math.PI*2+a.rotation,g=o.size*.8,f=d*.4;l.save(),l.translate(t,r),l.rotate(p);const h=l.createLinearGradient(d,0,g,0);h.addColorStop(0,`rgba(255, 150, 50, ${o.alpha*.6})`),h.addColorStop(.5,`rgba(255, 80, 0, ${o.alpha*.4})`),h.addColorStop(1,"transparent"),l.fillStyle=h,l.beginPath(),l.moveTo(d*.8,0),l.lineTo(g,-f*.2),l.lineTo(g,f*.2),l.closePath(),l.fill(),l.restore()}}else a.coronaExplosion=null}const T=d*1.8,G=l.createRadialGradient(t,r,d*.5,t,r,T);G.addColorStop(0,`rgba(255, 120, 50, ${.6+P*.3})`),G.addColorStop(.5,`rgba(255, 60, 20, ${.3+P*.2})`),G.addColorStop(1,"transparent"),l.fillStyle=G,l.beginPath(),l.arc(t,r,T,0,Math.PI*2),l.fill();const z=l.createRadialGradient(t-d*.2,r-d*.2,0,t,r,d);if(z.addColorStop(0,"#FFF5E0"),z.addColorStop(.2,"#FFCC66"),z.addColorStop(.4,"#FF8844"),z.addColorStop(.7,"#DD4422"),z.addColorStop(1,"#AA2200"),l.fillStyle=z,l.beginPath(),l.arc(t,r,d,0,Math.PI*2),l.fill(),!C)for(let i=0;i<3;i++){const u=i/3*Math.PI*2+a.rotation*.5,s=d*.4,p=t+Math.cos(u)*s,g=r+Math.sin(u)*s,f=d*(.12+i%2*.08),h=l.createRadialGradient(p,g,0,p,g,f);h.addColorStop(0,"rgba(80, 20, 5, 0.5)"),h.addColorStop(1,"transparent"),l.fillStyle=h,l.beginPath(),l.arc(p,g,f,0,Math.PI*2),l.fill()}}export{D as default};
