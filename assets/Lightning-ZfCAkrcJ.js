const g={bolts:[],lastBeat:0,electricField:[]};function S(n,d,o,s){const r=[{x:n,y:d}];let p=n,h=d;const f=12+Math.random()*8;for(;h<o;){h+=f;const c=(Math.random()-.5)*(40+s*50);p+=c,r.push({x:p,y:h})}return r}function w(n,d,o){const s=S(n,-10,d,o);return{segments:s,currentLength:1,maxLength:s.length,alpha:1,hue:180+Math.random()*60,width:2+o*3,speed:3+o*4+Math.random()*2}}function $({ctx:n,canvas:d,data:o,performanceMode:s=!1,beatIntensity:r=0,bass:p=0}){const h=d.width,f=d.height,c=o.reduce((e,t)=>e+t,0)/o.length;if(p>.35&&Date.now()-g.lastBeat>120){const e=s?1:Math.floor(1+r*2);for(let a=0;a<e;a++){const l=h*.2+Math.random()*h*.6,i=f*(.5+Math.random()*.5);g.bolts.push(w(l,i,r))}const t=Math.floor(r*12);for(let a=0;a<t;a++)g.electricField.push({x:Math.random()*h,y:Math.random()*f*.7,age:0});g.lastBeat=Date.now()}if(Math.random()<.015+c*.02){const e=h*.1+Math.random()*h*.8,t=f*(.3+Math.random()*.4);g.bolts.push(w(e,t,c*.6))}if(g.electricField=g.electricField.filter(e=>{if(e.age+=.06,e.age>1)return!1;const t=1-e.age,a=1.5+(1-e.age)*2;return n.beginPath(),n.arc(e.x,e.y,a,0,Math.PI*2),n.fillStyle=`rgba(150, 200, 255, ${t*.7})`,n.fill(),!0}),g.bolts=g.bolts.filter(e=>{if(e.alpha<=0)return!1;e.currentLength<e.maxLength&&(e.currentLength=Math.min(e.currentLength+e.speed,e.maxLength));const t=Math.floor(e.currentLength);if(t<2)return!0;n.beginPath(),n.moveTo(e.segments[0].x,e.segments[0].y);for(let a=1;a<t;a++)n.lineTo(e.segments[a].x,e.segments[a].y);if(t<e.segments.length){const a=e.currentLength-t,l=e.segments[t-1],i=e.segments[t],u=l.x+(i.x-l.x)*a,m=l.y+(i.y-l.y)*a;n.lineTo(u,m)}if(s||(n.shadowColor=`hsla(${e.hue}, 100%, 70%, ${e.alpha})`,n.shadowBlur=20+r*15),n.strokeStyle=`hsla(${e.hue}, 100%, 75%, ${e.alpha})`,n.lineWidth=e.width*e.alpha,n.lineCap="round",n.lineJoin="round",n.stroke(),!s&&e.alpha>.5&&(n.strokeStyle=`rgba(255, 255, 255, ${e.alpha*.8})`,n.lineWidth=e.width*.35*e.alpha,n.stroke()),n.shadowBlur=0,e.currentLength<e.maxLength){const a=Math.min(t,e.segments.length-1),l=e.currentLength-Math.floor(e.currentLength);let i,u;if(a<e.segments.length-1){const L=e.segments[a],M=e.segments[a+1];i=L.x+(M.x-L.x)*l,u=L.y+(M.y-L.y)*l}else i=e.segments[a].x,u=e.segments[a].y;const m=n.createRadialGradient(i,u,0,i,u,15+r*10);m.addColorStop(0,`hsla(${e.hue}, 100%, 90%, ${e.alpha})`),m.addColorStop(.3,`hsla(${e.hue}, 100%, 70%, ${e.alpha*.6})`),m.addColorStop(1,"transparent"),n.beginPath(),n.arc(i,u,15+r*10,0,Math.PI*2),n.fillStyle=m,n.fill()}return e.currentLength>=e.maxLength&&(e.alpha-=s?.06:.035),e.alpha>0}),!s){const e=n.createLinearGradient(0,0,0,60);e.addColorStop(0,`rgba(100, 150, 255, ${.1+c*.15})`),e.addColorStop(1,"transparent"),n.fillStyle=e,n.fillRect(0,0,h,60)}if(r>.7){const e=(r-.7)*.25;n.fillStyle=`rgba(180, 220, 255, ${e})`,n.fillRect(0,0,h,f)}}export{$ as default};
